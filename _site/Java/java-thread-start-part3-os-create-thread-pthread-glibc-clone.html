<!DOCTYPE html>
<html lang="en">
    <head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
        <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>
    
        [Java Multithreading] Part 3 – JVM이 OS 스레드를 만드는 과정: JavaThread, os::create_thread, pthread_create, glibc, clone()
    
</title>
<!-- Begin Jekyll SEO tag v2.8.0 -->
<title>[Java Multithreading] Part 3 – JVM이 OS 스레드를 만드는 과정: JavaThread, os::create_thread, pthread_create, glibc, clone() | Gimin’s Blog</title>
<meta name="generator" content="Jekyll v4.4.1">
<meta property="og:title" content="[Java Multithreading] Part 3 – JVM이 OS 스레드를 만드는 과정: JavaThread, os::create_thread, pthread_create, glibc, clone()">
<meta property="og:locale" content="en_US">
<meta name="description" content="[Java Multithreading] Part 3 – JVM이 OS 스레드를 만드는 과정: JavaThread, os::create_thread, pthread_create, glibc, clone()">
<meta property="og:description" content="[Java Multithreading] Part 3 – JVM이 OS 스레드를 만드는 과정: JavaThread, os::create_thread, pthread_create, glibc, clone()">
<link rel="canonical" href="http://localhost:4000/Java/java-thread-start-part3-os-create-thread-pthread-glibc-clone.html">
<meta property="og:url" content="http://localhost:4000/Java/java-thread-start-part3-os-create-thread-pthread-glibc-clone.html">
<meta property="og:site_name" content="Gimin’s Blog">
<meta property="og:type" content="article">
<meta property="article:published_time" content="2025-10-04T08:30:00+09:00">
<meta name="twitter:card" content="summary">
<meta property="twitter:title" content="[Java Multithreading] Part 3 – JVM이 OS 스레드를 만드는 과정: JavaThread, os::create_thread, pthread_create, glibc, clone()">
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2025-10-04T08:30:00+09:00","datePublished":"2025-10-04T08:30:00+09:00","description":"[Java Multithreading] Part 3 – JVM이 OS 스레드를 만드는 과정: JavaThread, os::create_thread, pthread_create, glibc, clone()","headline":"[Java Multithreading] Part 3 – JVM이 OS 스레드를 만드는 과정: JavaThread, os::create_thread, pthread_create, glibc, clone()","mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/Java/java-thread-start-part3-os-create-thread-pthread-glibc-clone.html"},"url":"http://localhost:4000/Java/java-thread-start-part3-os-create-thread-pthread-glibc-clone.html"}</script>
<!-- End Jekyll SEO tag -->


<link rel="shortcut icon" type="image/png" href="/assets/img/favicon.webp">
<style>
@font-face {
    font-family: 'Nunito Sans';
    font-style: normal;
    font-weight: 400;
    font-display: optional;
    src: local('Nunito Sans'),
         url("/assets/fonts/NunitoSans-Regular.woff2") format("woff2");
}

@font-face {
    font-family: 'Righteous';
    font-style: normal;
    font-weight: 600;
    font-display: optional;
    src: local('Righteous'),
         url("/assets/fonts/Righteous-Regular.woff2") format("woff2");
}

@font-face {
    font-family: 'Lato';
    font-style: normal;
    font-weight: 400;
    font-display: optional;
    src: local('Lato'),
         url("/assets/fonts/Lato-Regular.woff2") format("woff2");
}
</style>

<script src="/assets/js/fontfaceobserver.js" type="text/javascript"></script>
<script type="text/javascript">
    const nunitoObserver = new FontFaceObserver('Nunito Sans');
    const righteousObserver = new FontFaceObserver('Righteous');
    const latoObserver = new FontFaceObserver('Lato');
  
    Promise.all([
        nunitoObserver.load(),
        righteousObserver.load(),
        latoObserver.load(),
    ]).then(function(){
        document.documentElement.className += " fonts-loaded";
    });
</script>

<meta name="baseurl" content="">
<meta name="description" content="시스템 설계와 깊게 공부하는 것을 좋아하는 개발자의 블로그입니다.">
        <link rel="preload" href="/assets/img/profile.jpg" as="image">
        <link rel="stylesheet" href="/assets/css/style.css">
        
            

            <meta name="giscus_repo" content="">
            <meta name="giscus_repoId" content="">
            <meta name="giscus_category" content="">
            <meta name="giscus_categoryId" content="">

            
                <style>
                        .thumbnail {
                            background-image: url("");
                        }
                    
                </style>
            
        
    </head>
    <body>
        <script type="text/javascript">
            let currentTheme = localStorage.getItem('theme');
        
            document.body.classList[currentTheme === 'dark' ? 'add' : 'remove']('dark-theme');
        </script>
        <canvas id="stars" width="100%" height="100%"></canvas>
        <div class="sidebar sidebar-left">
    <div class="side-banner">
        <h1 class="site-tab">
            <a href="/" class="site-name">
                <img src="/assets/img/icon/house.webp" alt="" loading="lazy">
                <mark>Gimin's Blog</mark>
            </a>
            <button id="btn-brightness" aria-label="brightness-button">
                <svg class="ico-dark" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 384 512"><path d="M223.5 32C100 32 0 132.3 0 256S100 480 223.5 480c60.6 0 115.5-24.2 155.8-63.4c5-4.9 6.3-12.5 3.1-18.7s-10.1-9.7-17-8.5c-9.8 1.7-19.8 2.6-30.1 2.6c-96.9 0-175.5-78.8-175.5-176c0-65.8 36-123.1 89.3-153.3c6.1-3.5 9.2-10.5 7.7-17.3s-7.3-11.9-14.3-12.5c-6.3-.5-12.6-.8-19-.8z"></path></svg>
                <svg class="ico-light" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 512 512"><path d="M361.5 1.2c5 2.1 8.6 6.6 9.6 11.9L391 121l107.9 19.8c5.3 1 9.8 4.6 11.9 9.6s1.5 10.7-1.6 15.2L446.9 256l62.3 90.3c3.1 4.5 3.7 10.2 1.6 15.2s-6.6 8.6-11.9 9.6L391 391 371.1 498.9c-1 5.3-4.6 9.8-9.6 11.9s-10.7 1.5-15.2-1.6L256 446.9l-90.3 62.3c-4.5 3.1-10.2 3.7-15.2 1.6s-8.6-6.6-9.6-11.9L121 391 13.1 371.1c-5.3-1-9.8-4.6-11.9-9.6s-1.5-10.7 1.6-15.2L65.1 256 2.8 165.7c-3.1-4.5-3.7-10.2-1.6-15.2s6.6-8.6 11.9-9.6L121 121 140.9 13.1c1-5.3 4.6-9.8 9.6-11.9s10.7-1.5 15.2 1.6L256 65.1 346.3 2.8c4.5-3.1 10.2-3.7 15.2-1.6zM160 256a96 96 0 1 1 192 0 96 96 0 1 1 -192 0zm224 0a128 128 0 1 0 -256 0 128 128 0 1 0 256 0z"></path></svg>
            </button>
            <button id="btn-search" aria-label="search-button">
                <svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 512 512"><path d="M416 208c0 45.9-14.9 88.3-40 122.7L502.6 457.4c12.5 12.5 12.5 32.8 0 45.3s-32.8 12.5-45.3 0L330.7 376c-34.4 25.2-76.8 40-122.7 40C93.1 416 0 322.9 0 208S93.1 0 208 0S416 93.1 416 208zM208 352a144 144 0 1 0 0-288 144 144 0 1 0 0 288z"></path></svg>
            </button>
            <button id="btn-nav" aria-pressed="false" aria-label="menu-button">
                <svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 448 512"><path d="M0 96C0 78.3 14.3 64 32 64H416c17.7 0 32 14.3 32 32s-14.3 32-32 32H32C14.3 128 0 113.7 0 96zM0 256c0-17.7 14.3-32 32-32H416c17.7 0 32 14.3 32 32s-14.3 32-32 32H32c-17.7 0-32-14.3-32-32zM448 416c0 17.7-14.3 32-32 32H32c-17.7 0-32-14.3-32-32s14.3-32 32-32H416c17.7 0 32 14.3 32 32z"></path></svg>
            </button>
        </h1>
        <a href="/" class="site-avatar" aria-label="site-avatar">
            <img src="/assets/img/profile.jpg" loading="lazy" alt="homepage" aria-label="homepage-button">
        </a>
    </div>
    <div class="side-info">
        <nav id="navigation">
    
    
    

    

        
    

        
    

        
    

        
    

        
    

        
    

        
    

        
    

        
    

        
    
            
            
            
            
            
            
            
            
            
            

    
    
    

    <ul class="nav-list">
<li id="nav-first" aria-label="Java">
            <div class="nav-item">
                <a href="/Java/" class="nav-list-link nav-lh">
                    <svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 448 512"><path d="M181.3 32.4c17.4 2.9 29.2 19.4 26.3 36.8L197.8 128h95.1l11.5-69.3c2.9-17.4 19.4-29.2 36.8-26.3s29.2 19.4 26.3 36.8L357.8 128H416c17.7 0 32 14.3 32 32s-14.3 32-32 32H347.1L325.8 320H384c17.7 0 32 14.3 32 32s-14.3 32-32 32H315.1l-11.5 69.3c-2.9 17.4-19.4 29.2-36.8 26.3s-29.2-19.4-26.3-36.8l9.8-58.7H155.1l-11.5 69.3c-2.9 17.4-19.4 29.2-36.8 26.3s-29.2-19.4-26.3-36.8L90.2 384H32c-17.7 0-32-14.3-32-32s14.3-32 32-32h68.9l21.3-128H64c-17.7 0-32-14.3-32-32s14.3-32 32-32h68.9l11.5-69.3c2.9-17.4 19.4-29.2 36.8-26.3zM187.1 192L165.8 320h95.1l21.3-128H187.1z"></path></svg>
                    <span>Java</span>
                </a>
</div>
</li>
<li id="nav-first" aria-label="Spring Boot">
            <div class="nav-item">
                <a href="/Spring%20Boot/" class="nav-list-link nav-lh">
                    <svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 448 512"><path d="M181.3 32.4c17.4 2.9 29.2 19.4 26.3 36.8L197.8 128h95.1l11.5-69.3c2.9-17.4 19.4-29.2 36.8-26.3s29.2 19.4 26.3 36.8L357.8 128H416c17.7 0 32 14.3 32 32s-14.3 32-32 32H347.1L325.8 320H384c17.7 0 32 14.3 32 32s-14.3 32-32 32H315.1l-11.5 69.3c-2.9 17.4-19.4 29.2-36.8 26.3s-29.2-19.4-26.3-36.8l9.8-58.7H155.1l-11.5 69.3c-2.9 17.4-19.4 29.2-36.8 26.3s-29.2-19.4-26.3-36.8L90.2 384H32c-17.7 0-32-14.3-32-32s14.3-32 32-32h68.9l21.3-128H64c-17.7 0-32-14.3-32-32s14.3-32 32-32h68.9l11.5-69.3c2.9-17.4 19.4-29.2 36.8-26.3zM187.1 192L165.8 320h95.1l21.3-128H187.1z"></path></svg>
                    <span>Spring Boot</span>
                </a><button class="nav-list-expander" aria-label="toggle items in Spring Boot category" aria-pressed="false">
                    <svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 448 512"><path d="M201.4 342.6c12.5 12.5 32.8 12.5 45.3 0l160-160c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0L224 274.7 86.6 137.4c-12.5-12.5-32.8-12.5-45.3 0s-12.5 32.8 0 45.3l160 160z"></path></svg>
                </button>
</div>
<ul class="nav-list"><li id="nav-second" aria-label="Security">
                    <div class="nav-item">
                        <a href="/Spring%20Boot/Security/" class="nav-list-link nav-sh">
                            <svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 448 512"><path d="M432 256c0 17.7-14.3 32-32 32L48 288c-17.7 0-32-14.3-32-32s14.3-32 32-32l352 0c17.7 0 32 14.3 32 32z"></path></svg>
                            <span>Security</span>
                        </a>
</div>
</li></ul>
</li>
<li id="nav-first" aria-label="System Architecture">
            <div class="nav-item">
                <a href="/System%20Architecture/" class="nav-list-link nav-lh">
                    <svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 448 512"><path d="M181.3 32.4c17.4 2.9 29.2 19.4 26.3 36.8L197.8 128h95.1l11.5-69.3c2.9-17.4 19.4-29.2 36.8-26.3s29.2 19.4 26.3 36.8L357.8 128H416c17.7 0 32 14.3 32 32s-14.3 32-32 32H347.1L325.8 320H384c17.7 0 32 14.3 32 32s-14.3 32-32 32H315.1l-11.5 69.3c-2.9 17.4-19.4 29.2-36.8 26.3s-29.2-19.4-26.3-36.8l9.8-58.7H155.1l-11.5 69.3c-2.9 17.4-19.4 29.2-36.8 26.3s-29.2-19.4-26.3-36.8L90.2 384H32c-17.7 0-32-14.3-32-32s14.3-32 32-32h68.9l21.3-128H64c-17.7 0-32-14.3-32-32s14.3-32 32-32h68.9l11.5-69.3c2.9-17.4 19.4-29.2 36.8-26.3zM187.1 192L165.8 320h95.1l21.3-128H187.1z"></path></svg>
                    <span>System Architecture</span>
                </a><button class="nav-list-expander" aria-label="toggle items in System Architecture category" aria-pressed="false">
                    <svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 448 512"><path d="M201.4 342.6c12.5 12.5 32.8 12.5 45.3 0l160-160c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0L224 274.7 86.6 137.4c-12.5-12.5-32.8-12.5-45.3 0s-12.5 32.8 0 45.3l160 160z"></path></svg>
                </button>
</div>
<ul class="nav-list">
<li id="nav-second" aria-label="api-design">
                    <div class="nav-item">
                        <a href="/System%20Architecture/api-design/" class="nav-list-link nav-sh">
                            <svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 448 512"><path d="M432 256c0 17.7-14.3 32-32 32L48 288c-17.7 0-32-14.3-32-32s14.3-32 32-32l352 0c17.7 0 32 14.3 32 32z"></path></svg>
                            <span>api-design</span>
                        </a>
</div>
</li>
<li id="nav-second" aria-label="data-modeling-erd">
                    <div class="nav-item">
                        <a href="/System%20Architecture/data-modeling-erd/" class="nav-list-link nav-sh">
                            <svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 448 512"><path d="M432 256c0 17.7-14.3 32-32 32L48 288c-17.7 0-32-14.3-32-32s14.3-32 32-32l352 0c17.7 0 32 14.3 32 32z"></path></svg>
                            <span>data-modeling-erd</span>
                        </a>
</div>
</li>
<li id="nav-second" aria-label="security-auth">
                    <div class="nav-item">
                        <a href="/System%20Architecture/security-auth/" class="nav-list-link nav-sh">
                            <svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 448 512"><path d="M432 256c0 17.7-14.3 32-32 32L48 288c-17.7 0-32-14.3-32-32s14.3-32 32-32l352 0c17.7 0 32 14.3 32 32z"></path></svg>
                            <span>security-auth</span>
                        </a>
</div>
</li>
<li id="nav-second" aria-label="system-design">
                    <div class="nav-item">
                        <a href="/System%20Architecture/system-design/" class="nav-list-link nav-sh">
                            <svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 448 512"><path d="M432 256c0 17.7-14.3 32-32 32L48 288c-17.7 0-32-14.3-32-32s14.3-32 32-32l352 0c17.7 0 32 14.3 32 32z"></path></svg>
                            <span>system-design</span>
                        </a>
</div>
</li>
</ul>
</li>
<li id="nav-first" aria-label="Trouble Shooting">
            <div class="nav-item">
                <a href="/Trouble%20Shooting/" class="nav-list-link nav-lh">
                    <svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 448 512"><path d="M181.3 32.4c17.4 2.9 29.2 19.4 26.3 36.8L197.8 128h95.1l11.5-69.3c2.9-17.4 19.4-29.2 36.8-26.3s29.2 19.4 26.3 36.8L357.8 128H416c17.7 0 32 14.3 32 32s-14.3 32-32 32H347.1L325.8 320H384c17.7 0 32 14.3 32 32s-14.3 32-32 32H315.1l-11.5 69.3c-2.9 17.4-19.4 29.2-36.8 26.3s-29.2-19.4-26.3-36.8l9.8-58.7H155.1l-11.5 69.3c-2.9 17.4-19.4 29.2-36.8 26.3s-29.2-19.4-26.3-36.8L90.2 384H32c-17.7 0-32-14.3-32-32s14.3-32 32-32h68.9l21.3-128H64c-17.7 0-32-14.3-32-32s14.3-32 32-32h68.9l11.5-69.3c2.9-17.4 19.4-29.2 36.8-26.3zM187.1 192L165.8 320h95.1l21.3-128H187.1z"></path></svg>
                    <span>Trouble Shooting</span>
                </a>
</div>
</li>
<li id="nav-first" aria-label="Home">
            <div class="nav-item">
                <a href="/" class="nav-list-link nav-lh">
                    <svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 448 512"><path d="M181.3 32.4c17.4 2.9 29.2 19.4 26.3 36.8L197.8 128h95.1l11.5-69.3c2.9-17.4 19.4-29.2 36.8-26.3s29.2 19.4 26.3 36.8L357.8 128H416c17.7 0 32 14.3 32 32s-14.3 32-32 32H347.1L325.8 320H384c17.7 0 32 14.3 32 32s-14.3 32-32 32H315.1l-11.5 69.3c-2.9 17.4-19.4 29.2-36.8 26.3s-29.2-19.4-26.3-36.8l9.8-58.7H155.1l-11.5 69.3c-2.9 17.4-19.4 29.2-36.8 26.3s-29.2-19.4-26.3-36.8L90.2 384H32c-17.7 0-32-14.3-32-32s14.3-32 32-32h68.9l21.3-128H64c-17.7 0-32-14.3-32-32s14.3-32 32-32h68.9l11.5-69.3c2.9-17.4 19.4-29.2 36.8-26.3zM187.1 192L165.8 320h95.1l21.3-128H187.1z"></path></svg>
                    <span>Home</span>
                </a>
</div>
</li>
</ul>
</nav>
        <div id="contact">
            <hr>
            <h3>Contact</h3>
            <ul class="contact-list">
                
                    <li><a aria-label="My Github" href="https://github.com/Gimini-3">
                        <svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 496 512"><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3 .3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5 .3-6.2 2.3zm44.2-1.7c-2.9 .7-4.9 2.6-4.6 4.9 .3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3 .7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3 .3 2.9 2.3 3.9 1.6 1 3.6 .7 4.3-.7 .7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3 .7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3 .7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"></path></svg>
                    </a></li>
                
                
                    <li><a aria-label="My Email" href="mailto:gimin1463@naver.com">
                        <svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 512 512"><path d="M48 64C21.5 64 0 85.5 0 112c0 15.1 7.1 29.3 19.2 38.4L236.8 313.6c11.4 8.5 27 8.5 38.4 0L492.8 150.4c12.1-9.1 19.2-23.3 19.2-38.4c0-26.5-21.5-48-48-48H48zM0 176V384c0 35.3 28.7 64 64 64H448c35.3 0 64-28.7 64-64V176L294.4 339.2c-22.8 17.1-54 17.1-76.8 0L0 176z"></path></svg>
                    </a></li>
                
                
                
                    <li><a aria-label="My Instagram" href="https://www.instagram.com/gimin0226">
                        <svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 448 512"><path d="M224.1 141c-63.6 0-114.9 51.3-114.9 114.9s51.3 114.9 114.9 114.9S339 319.5 339 255.9 287.7 141 224.1 141zm0 189.6c-41.1 0-74.7-33.5-74.7-74.7s33.5-74.7 74.7-74.7 74.7 33.5 74.7 74.7-33.6 74.7-74.7 74.7zm146.4-194.3c0 14.9-12 26.8-26.8 26.8-14.9 0-26.8-12-26.8-26.8s12-26.8 26.8-26.8 26.8 12 26.8 26.8zm76.1 27.2c-1.7-35.9-9.9-67.7-36.2-93.9-26.2-26.2-58-34.4-93.9-36.2-37-2.1-147.9-2.1-184.9 0-35.8 1.7-67.6 9.9-93.9 36.1s-34.4 58-36.2 93.9c-2.1 37-2.1 147.9 0 184.9 1.7 35.9 9.9 67.7 36.2 93.9s58 34.4 93.9 36.2c37 2.1 147.9 2.1 184.9 0 35.9-1.7 67.7-9.9 93.9-36.2 26.2-26.2 34.4-58 36.2-93.9 2.1-37 2.1-147.8 0-184.8zM398.8 388c-7.8 19.6-22.9 34.7-42.6 42.6-29.5 11.7-99.5 9-132.1 9s-102.7 2.6-132.1-9c-19.6-7.8-34.7-22.9-42.6-42.6-11.7-29.5-9-99.5-9-132.1s-2.6-102.7 9-132.1c7.8-19.6 22.9-34.7 42.6-42.6 29.5-11.7 99.5-9 132.1-9s102.7-2.6 132.1 9c19.6 7.8 34.7 22.9 42.6 42.6 11.7 29.5 9 99.5 9 132.1s2.7 102.7-9 132.1z"></path></svg>
                    </a></li>
                
                
                
                    <li><a aria-label="My LinkedIn" href="https://www.linkedin.com/in/g-m-627b33392">
                        <svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 448 512"><path d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9V416z"></path></svg>
                    </a></li>
                
            </ul>
            <hr>
            <span>
                Copyright © 2024 | <a href="https://github.com/byanko55/jekyll-theme-satellite">Yankos</a>
            </span>
        </div>
    </div>
</div>
<div class="sidebar sidebar-right">
    <div class="tools">
        <button id="btn-brightness" aria-label="brightness-button">
            <svg class="ico-dark" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 384 512"><path d="M223.5 32C100 32 0 132.3 0 256S100 480 223.5 480c60.6 0 115.5-24.2 155.8-63.4c5-4.9 6.3-12.5 3.1-18.7s-10.1-9.7-17-8.5c-9.8 1.7-19.8 2.6-30.1 2.6c-96.9 0-175.5-78.8-175.5-176c0-65.8 36-123.1 89.3-153.3c6.1-3.5 9.2-10.5 7.7-17.3s-7.3-11.9-14.3-12.5c-6.3-.5-12.6-.8-19-.8z"></path></svg>
            <svg class="ico-light" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 512 512"><path d="M361.5 1.2c5 2.1 8.6 6.6 9.6 11.9L391 121l107.9 19.8c5.3 1 9.8 4.6 11.9 9.6s1.5 10.7-1.6 15.2L446.9 256l62.3 90.3c3.1 4.5 3.7 10.2 1.6 15.2s-6.6 8.6-11.9 9.6L391 391 371.1 498.9c-1 5.3-4.6 9.8-9.6 11.9s-10.7 1.5-15.2-1.6L256 446.9l-90.3 62.3c-4.5 3.1-10.2 3.7-15.2 1.6s-8.6-6.6-9.6-11.9L121 391 13.1 371.1c-5.3-1-9.8-4.6-11.9-9.6s-1.5-10.7 1.6-15.2L65.1 256 2.8 165.7c-3.1-4.5-3.7-10.2-1.6-15.2s6.6-8.6 11.9-9.6L121 121 140.9 13.1c1-5.3 4.6-9.8 9.6-11.9s10.7-1.5 15.2 1.6L256 65.1 346.3 2.8c4.5-3.1 10.2-3.7 15.2-1.6zM160 256a96 96 0 1 1 192 0 96 96 0 1 1 -192 0zm224 0a128 128 0 1 0 -256 0 128 128 0 1 0 256 0z"></path></svg>
        </button>
        <button id="btn-search" aria-label="search-button">
            <svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 512 512"><path d="M416 208c0 45.9-14.9 88.3-40 122.7L502.6 457.4c12.5 12.5 12.5 32.8 0 45.3s-32.8 12.5-45.3 0L330.7 376c-34.4 25.2-76.8 40-122.7 40C93.1 416 0 322.9 0 208S93.1 0 208 0S416 93.1 416 208zM208 352a144 144 0 1 0 0-288 144 144 0 1 0 0 288z"></path></svg>
        </button>
    </div>
<div class="toc">
        <span class="toc-header">
            <svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 384 512"><path d="M0 48V487.7C0 501.1 10.9 512 24.3 512c5 0 9.9-1.5 14-4.4L192 400 345.7 507.6c4.1 2.9 9 4.4 14 4.4c13.4 0 24.3-10.9 24.3-24.3V48c0-26.5-21.5-48-48-48H48C21.5 0 0 21.5 0 48z"></path></svg>
            Contents
        </span>
        <div class="toc-board"></div>
    </div>
</div>
        <div id="post">
            <div class="inner-header">
                <span class="dot" style="background-color: #F86158;"></span>
                <span class="dot" style="background-color: #FBBF2D;"></span>
                <span class="dot" style="background-color: #2ACB45;"></span>
            </div>
            <div class="inner-content">
                <div class="category-tree">
<svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 576 512"><path d="M575.8 255.5c0 18-15 32.1-32 32.1h-32l.7 160.2c0 2.7-.2 5.4-.5 8.1V472c0 22.1-17.9 40-40 40H456c-1.1 0-2.2 0-3.3-.1c-1.4 .1-2.8 .1-4.2 .1H416 392c-22.1 0-40-17.9-40-40V448 384c0-17.7-14.3-32-32-32H256c-17.7 0-32 14.3-32 32v64 24c0 22.1-17.9 40-40 40H160 128.1c-1.5 0-3-.1-4.5-.2c-1.2 .1-2.4 .2-3.6 .2H104c-22.1 0-40-17.9-40-40V360c0-.9 0-1.9 .1-2.8V287.6H32c-18 0-32-14-32-32.1c0-9 3-17 10-24L266.4 8c7-7 15-8 22-8s15 2 21 7L564.8 231.5c8 7 12 15 11 24z"></path></svg>
    <p>
                <a href="/">Home</a>
                &gt;
            <a href="/Java/">Java</a>
                &gt;
            
                
                    [Java Multithreading] Part 3 – JVM이 OS 스레드를 만드는 과정: JavaThread, os::create_thread, pthread_create, glibc, clone()
                
            </p>
</div>
                
                    <div class="post-header">
    <div class="thumbnail">
        <div class="transbox">
            
                <span class="post-title">[Java Multithreading] Part 3 – JVM이 OS 스레드를 만드는 과정: JavaThread, os::create_thread, pthread_create, glibc, clone()</span>
            
            <div class="post-info">
                
                    <span class="info-box">
                        <svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 576 512"><path d="M384 480h48c11.4 0 21.9-6 27.6-15.9l112-192c5.8-9.9 5.8-22.1 .1-32.1S555.5 224 544 224H144c-11.4 0-21.9 6-27.6 15.9L48 357.1V96c0-8.8 7.2-16 16-16H181.5c4.2 0 8.3 1.7 11.3 4.7l26.5 26.5c21 21 49.5 32.8 79.2 32.8H416c8.8 0 16 7.2 16 16v32h48V160c0-35.3-28.7-64-64-64H298.5c-17 0-33.3-6.7-45.3-18.7L226.7 50.7c-12-12-28.3-18.7-45.3-18.7H64C28.7 32 0 60.7 0 96V416c0 35.3 28.7 64 64 64H87.7 384z"></path></svg>
                        <span>None</span>
                    </span>
                
                <span class="info-box">
                    <svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 448 512"><path d="M152 24c0-13.3-10.7-24-24-24s-24 10.7-24 24V64H64C28.7 64 0 92.7 0 128v16 48V448c0 35.3 28.7 64 64 64H384c35.3 0 64-28.7 64-64V192 144 128c0-35.3-28.7-64-64-64H344V24c0-13.3-10.7-24-24-24s-24 10.7-24 24V64H152V24zM48 192h80v56H48V192zm0 104h80v64H48V296zm128 0h96v64H176V296zm144 0h80v64H320V296zm80-48H320V192h80v56zm0 160v40c0 8.8-7.2 16-16 16H320V408h80zm-128 0v56H176V408h96zm-144 0v56H64c-8.8 0-16-7.2-16-16V408h80zM272 248H176V192h96v56z"></path></svg>
                    <span>
                            2025-10-04
                        
                    </span>
                </span>
                
                <a class="info-box" id="comments-counter">
                    <svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 512 512"><path d="M512 240c0 114.9-114.6 208-256 208c-37.1 0-72.3-6.4-104.1-17.9c-11.9 8.7-31.3 20.6-54.3 30.6C73.6 471.1 44.7 480 16 480c-6.5 0-12.3-3.9-14.8-9.9c-2.5-6-1.1-12.8 3.4-17.4l0 0 0 0 0 0 0 0 .3-.3c.3-.3 .7-.7 1.3-1.4c1.1-1.2 2.8-3.1 4.9-5.7c4.1-5 9.6-12.4 15.2-21.6c10-16.6 19.5-38.4 21.4-62.9C17.7 326.8 0 285.1 0 240C0 125.1 114.6 32 256 32s256 93.1 256 208z"></path></svg>
                    <span id="num-comments">-</span>
                </a>
            </div>
        </div>
    </div>
</div>
<div class="tag-box">
<span class="tag theme-0" contentid="java">
            java
        </span><span class="tag theme-1" contentid="concurrency">
            concurrency
        </span><span class="tag theme-2" contentid="thread">
            thread
        </span><span class="tag theme-0" contentid="start">
            start
        </span><span class="tag theme-1" contentid="run">
            run
        </span><span class="tag theme-2" contentid="jvm">
            jvm
        </span>
</div>
<main>
    <h1 id="java-multithreading-part-3--jvm이-os-스레드를-만드는-과정-javathread-oscreate_thread-pthread_create-glibc-clone">[Java Multithreading] Part 3 – JVM이 OS 스레드를 만드는 과정: JavaThread, os::create_thread, pthread_create, glibc, clone()</h1>

<h2 id="0-이번-파트에서-보는-것">0. 이번 파트에서 보는 것</h2>

<p>Part 2에서 여기까지 내려왔다:</p>

<blockquote>
  <p>Thread.start()</p>

  <p>→ <code class="language-plaintext highlighter-rouge">start0()</code> (native)</p>

  <p>→ <code class="language-plaintext highlighter-rouge">JVM_StartThread</code></p>

  <p>→ <code class="language-plaintext highlighter-rouge">new JavaThread(thread_entry, stackSize)</code></p>

  <p>→ <code class="language-plaintext highlighter-rouge">Thread::start(native_thread)</code> 호출 직전</p>

</blockquote>

<p>이제 <strong>“JVM이 실제 OS 스레드를 어떻게 만드는지”</strong>를 따라갈 차례다.</p>

<p>이번 Part 3에서 다룰 범위는:</p>

<ul>
  <li>
<code class="language-plaintext highlighter-rouge">JavaThread</code> 생성자 안에서 호출되는 <code class="language-plaintext highlighter-rouge">os::create_thread(...)</code>
</li>
  <li>
<code class="language-plaintext highlighter-rouge">OSThread</code> 생성, <code class="language-plaintext highlighter-rouge">pthread_attr</code> 설정, <code class="language-plaintext highlighter-rouge">pthread_create</code> 호출</li>
  <li>그 아래에서 glibc가 <code class="language-plaintext highlighter-rouge">clone()</code> 시스템콜로 리눅스 커널에 스레드 생성 요청하는 흐름</li>
  <li>정리: <strong>HotSpot 레벨 ↔ glibc 레벨 ↔ 커널 레벨</strong> 세 층 구조</li>
</ul>

<p>“새 스레드를 만든다”는 한 줄이</p>

<p>실제로는 <strong>세 겹</strong>을 타고 내려가는 일이라는 걸 보는 파트다.</p>

<hr>

<h2 id="1-part-2-끝에서-우리는-어디까지-왔나">1. Part 2 끝에서 우리는 어디까지 왔나?</h2>

<p>Part 2 마지막 지점부터 다시 한 번 흐름을 짚어보면:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Thread.start()       // 자바
  → start0()         // native
    → JVM_StartThread(JNIEnv* env, jobject jthread)  // HotSpot C++
      → new JavaThread(&amp;thread_entry, stackSize)     // JVM 내부 스레드 객체 생성
      → JavaThread::prepare(jthread)                 // 자바 Thread와 연결
      → Thread::start(native_thread)                 // 실행 상태 전환 + OS 스레드 시작

</code></pre></div></div>

<p>오늘 보는 핵심은 이 줄 속에서:</p>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">native_thread</span> <span class="o">=</span> <span class="k">new</span> <span class="nf">JavaThread</span><span class="p">(</span><span class="o">&amp;</span><span class="n">thread_entry</span><span class="p">,</span> <span class="n">sz</span><span class="p">);</span>

</code></pre></div></div>

<p><strong>이 한 줄이 실제로 OS 스레드를 어떻게 만드는지</strong>이다.</p>

<hr>

<h2 id="2-javathread-생성자-여기서-oscreate_thread가-호출된다">2. JavaThread 생성자: 여기서 <code class="language-plaintext highlighter-rouge">os::create_thread(...)</code>가 호출된다</h2>

<p>HotSpot의 <code class="language-plaintext highlighter-rouge">JavaThread</code> 생성자는 대략 이런 구조다 (불필요한 부분을 많이 생략한 버전):</p>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// openjdk/jdk/src/hotspot/share/runtime/javaThread.cpp</span>

<span class="n">JavaThread</span><span class="o">::</span><span class="n">JavaThread</span><span class="p">(</span><span class="n">ThreadFunction</span> <span class="n">entry_point</span><span class="p">,</span> <span class="kt">size_t</span> <span class="n">stack_sz</span><span class="p">,</span> <span class="n">MemTag</span> <span class="n">mem_tag</span><span class="p">)</span>
  <span class="o">:</span> <span class="n">JavaThread</span><span class="p">(</span><span class="n">mem_tag</span><span class="p">)</span> <span class="p">{</span>

  <span class="n">set_entry_point</span><span class="p">(</span><span class="n">entry_point</span><span class="p">);</span> <span class="c1">// 나중에 실행할 엔트리 포인트 (보통 thread_entry)</span>

  <span class="c1">// 어떤 타입의 스레드인지 결정</span>
  <span class="n">os</span><span class="o">::</span><span class="n">ThreadType</span> <span class="n">thr_type</span> <span class="o">=</span> <span class="n">os</span><span class="o">::</span><span class="n">java_thread</span><span class="p">;</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">entry_point</span> <span class="o">==</span> <span class="o">&amp;</span><span class="n">CompilerThread</span><span class="o">::</span><span class="n">thread_entry</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">thr_type</span> <span class="o">=</span> <span class="n">os</span><span class="o">::</span><span class="n">compiler_thread</span><span class="p">;</span>
  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="n">thr_type</span> <span class="o">=</span> <span class="n">os</span><span class="o">::</span><span class="n">java_thread</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="c1">// 실제 OS 스레드 생성 시도</span>
  <span class="n">os</span><span class="o">::</span><span class="n">create_thread</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="n">thr_type</span><span class="p">,</span> <span class="n">stack_sz</span><span class="p">);</span>

  <span class="c1">// 이 시점에서 _osthread는 null일 수도 있다 (리소스 부족 등)</span>
  <span class="c1">// 실패 여부 확인은 상위(JVM_StartThread)에서 한다.</span>
<span class="p">}</span>

</code></pre></div></div>

<h3 id="2-1-threadfunction-entry_point--스레드가-살아나면-제일-먼저-들어갈-함수">2-1. <code class="language-plaintext highlighter-rouge">ThreadFunction entry_point</code> – 스레드가 살아나면 제일 먼저 들어갈 함수</h3>

<ul>
  <li>
<code class="language-plaintext highlighter-rouge">entry_point</code>는 <strong>“이 스레드가 본격적으로 돌기 시작했을 때 호출할 함수 포인터”</strong>다.</li>
  <li>일반 자바 스레드의 경우 <code class="language-plaintext highlighter-rouge">thread_entry</code>가 들어온다.
    <ul>
      <li>
<code class="language-plaintext highlighter-rouge">thread_entry(JavaThread*, TRAPS)</code> 안에서 최종적으로 자바의 <code class="language-plaintext highlighter-rouge">Thread.run()</code>을 호출한다.</li>
      <li>
<code class="language-plaintext highlighter-rouge">thread_entry</code> 자세한 내용은 Part 4에서 본다.</li>
    </ul>
  </li>
</ul>

<h3 id="2-2-osthreadtype--스레드-종류역할에-따라-타입-분류">2-2. <code class="language-plaintext highlighter-rouge">os::ThreadType</code> – 스레드 종류(역할)에 따라 타입 분류</h3>

<p>HotSpot은 스레드를 종류별로 구분한다:</p>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">enum</span> <span class="n">ThreadType</span> <span class="p">{</span>
  <span class="n">java_thread</span><span class="p">,</span>       <span class="c1">// 일반 애플리케이션 자바 스레드 (new Thread())</span>
  <span class="n">compiler_thread</span><span class="p">,</span>   <span class="c1">// JIT 컴파일러 전용 스레드</span>
  <span class="n">vm_thread</span><span class="p">,</span>         <span class="c1">// VM 관리용 스레드</span>
  <span class="n">gc_thread</span><span class="p">,</span>         <span class="c1">// GC 워커 스레드</span>
  <span class="n">watcher_thread</span><span class="p">,</span>    <span class="c1">// WatcherThread (주기적 모니터링)</span>
  <span class="n">os_thread</span>          <span class="c1">// 기타 OS 내부용 스레드</span>
<span class="p">};</span>

</code></pre></div></div>

<ul>
  <li>우리가 <code class="language-plaintext highlighter-rouge">new Thread(...).start()</code>로 만드는 건 대부분 <code class="language-plaintext highlighter-rouge">java_thread</code>.</li>
  <li>JIT 컴파일러(C1/C2 등)용 스레드는 <code class="language-plaintext highlighter-rouge">compiler_thread</code>.</li>
  <li>GC, VM, Watcher 등도 각자 타입을 나눠 관리한다.</li>
</ul>

<p>이 타입 정보는:</p>

<ul>
  <li>스택 크기 기본값</li>
  <li>guard page 크기</li>
  <li>스케줄링/디버깅 옵션</li>
</ul>

<p>등을 결정할 때 사용된다.</p>

<h3 id="2-3-oscreate_threadthis-thr_type-stack_sz">2-3. <code class="language-plaintext highlighter-rouge">os::create_thread(this, thr_type, stack_sz);</code>
</h3>

<blockquote>
  <p>“지금 이 JavaThread를 실제 OS 스레드와 연결해서</p>

  <p>실행 가능한 상태로 만들어 줘.”</p>

</blockquote>

<p>라고 OS 의존 레이어에 요청하는 함수다.</p>

<hr>

<h2 id="3-oscreate_thread-내부-linux-기준">3. <code class="language-plaintext highlighter-rouge">os::create_thread</code> 내부 (Linux 기준)</h2>

<p>이제 리눅스 구현을 보자.</p>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// openjdk/jdk/src/hotspot/os/linux/os_linux.cpp</span>

<span class="kt">bool</span> <span class="n">os</span><span class="o">::</span><span class="n">create_thread</span><span class="p">(</span><span class="n">Thread</span><span class="o">*</span> <span class="kr">thread</span><span class="p">,</span> <span class="n">ThreadType</span> <span class="n">thr_type</span><span class="p">,</span> <span class="kt">size_t</span> <span class="n">req_stack_size</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// 1. OSThread 생성 및 연결</span>
  <span class="n">OSThread</span><span class="o">*</span> <span class="n">osthread</span> <span class="o">=</span> <span class="k">new</span> <span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">nothrow</span><span class="p">)</span> <span class="n">OSThread</span><span class="p">();</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">osthread</span> <span class="o">==</span> <span class="nb">nullptr</span><span class="p">)</span> <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
  <span class="n">osthread</span><span class="o">-&gt;</span><span class="n">set_state</span><span class="p">(</span><span class="n">ALLOCATED</span><span class="p">);</span>
  <span class="kr">thread</span><span class="o">-&gt;</span><span class="n">set_osthread</span><span class="p">(</span><span class="n">osthread</span><span class="p">);</span>

  <span class="c1">// 2. pthread 속성 초기화</span>
  <span class="n">pthread_attr_t</span> <span class="n">attr</span><span class="p">;</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">pthread_attr_init</span><span class="p">(</span><span class="o">&amp;</span><span class="n">attr</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
    <span class="kr">thread</span><span class="o">-&gt;</span><span class="n">set_osthread</span><span class="p">(</span><span class="nb">nullptr</span><span class="p">);</span>
    <span class="k">delete</span> <span class="n">osthread</span><span class="p">;</span>
    <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="n">pthread_attr_setdetachstate</span><span class="p">(</span><span class="o">&amp;</span><span class="n">attr</span><span class="p">,</span> <span class="n">PTHREAD_CREATE_DETACHED</span><span class="p">);</span>

  <span class="c1">// 3. 스택 크기 계산 및 설정</span>
  <span class="kt">size_t</span> <span class="n">stack_size</span> <span class="o">=</span> <span class="n">os</span><span class="o">::</span><span class="n">Posix</span><span class="o">::</span><span class="n">get_initial_stack_size</span><span class="p">(</span><span class="n">thr_type</span><span class="p">,</span> <span class="n">req_stack_size</span><span class="p">);</span>
  <span class="kt">size_t</span> <span class="n">guard_size</span> <span class="o">=</span> <span class="n">os</span><span class="o">::</span><span class="n">Linux</span><span class="o">::</span><span class="n">default_guard_size</span><span class="p">(</span><span class="n">thr_type</span><span class="p">);</span>
  <span class="n">pthread_attr_setguardsize</span><span class="p">(</span><span class="o">&amp;</span><span class="n">attr</span><span class="p">,</span> <span class="n">guard_size</span><span class="p">);</span>
  <span class="n">pthread_attr_setstacksize</span><span class="p">(</span><span class="o">&amp;</span><span class="n">attr</span><span class="p">,</span> <span class="n">stack_size</span><span class="p">);</span>

  <span class="c1">// 4. pthread_create 호출</span>
  <span class="n">pthread_t</span> <span class="n">tid</span><span class="p">;</span>
  <span class="kt">int</span> <span class="n">ret</span> <span class="o">=</span> <span class="n">pthread_create</span><span class="p">(</span><span class="o">&amp;</span><span class="n">tid</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">attr</span><span class="p">,</span>
                           <span class="p">(</span><span class="kt">void</span><span class="o">*</span> <span class="p">(</span><span class="o">*</span><span class="p">)(</span><span class="kt">void</span><span class="o">*</span><span class="p">))</span> <span class="n">thread_native_entry</span><span class="p">,</span>
                           <span class="kr">thread</span><span class="p">);</span>

  <span class="n">pthread_attr_destroy</span><span class="p">(</span><span class="o">&amp;</span><span class="n">attr</span><span class="p">);</span>

  <span class="k">if</span> <span class="p">(</span><span class="n">ret</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
    <span class="kr">thread</span><span class="o">-&gt;</span><span class="n">set_osthread</span><span class="p">(</span><span class="nb">nullptr</span><span class="p">);</span>
    <span class="k">delete</span> <span class="n">osthread</span><span class="p">;</span>
    <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="c1">// 5. 성공 시 OSThread에 pthread ID 기록</span>
  <span class="n">osthread</span><span class="o">-&gt;</span><span class="n">set_pthread_id</span><span class="p">(</span><span class="n">tid</span><span class="p">);</span>

  <span class="c1">// 6. 자식 스레드 초기화 대기</span>
  <span class="p">{</span>
    <span class="n">Monitor</span><span class="o">*</span> <span class="n">sync_with_child</span> <span class="o">=</span> <span class="n">osthread</span><span class="o">-&gt;</span><span class="n">startThread_lock</span><span class="p">();</span>
    <span class="n">MutexLocker</span> <span class="n">ml</span><span class="p">(</span><span class="n">sync_with_child</span><span class="p">,</span> <span class="n">Mutex</span><span class="o">::</span><span class="n">_no_safepoint_check_flag</span><span class="p">);</span>
    <span class="k">while</span> <span class="p">(</span><span class="n">osthread</span><span class="o">-&gt;</span><span class="n">get_state</span><span class="p">()</span> <span class="o">==</span> <span class="n">ALLOCATED</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">sync_with_child</span><span class="o">-&gt;</span><span class="n">wait_without_safepoint_check</span><span class="p">();</span>
    <span class="p">}</span>
  <span class="p">}</span>

  <span class="c1">// 7. INITIALIZED 상태에서 true 반환</span>
  <span class="k">return</span> <span class="nb">true</span><span class="p">;</span>
<span class="p">}</span>

</code></pre></div></div>

<p>이걸 단계별로 풀어보자.</p>

<hr>

<h2 id="4-1단계--osthread-생성-os-핸들을-관리할-껍데기">4. 1단계 – <code class="language-plaintext highlighter-rouge">OSThread</code> 생성: OS 핸들을 관리할 껍데기</h2>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">OSThread</span><span class="o">*</span> <span class="n">osthread</span> <span class="o">=</span> <span class="k">new</span> <span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">nothrow</span><span class="p">)</span> <span class="n">OSThread</span><span class="p">();</span>
<span class="k">if</span> <span class="p">(</span><span class="n">osthread</span> <span class="o">==</span> <span class="nb">nullptr</span><span class="p">)</span> <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
<span class="n">osthread</span><span class="o">-&gt;</span><span class="n">set_state</span><span class="p">(</span><span class="n">ALLOCATED</span><span class="p">);</span>
<span class="kr">thread</span><span class="o">-&gt;</span><span class="n">set_osthread</span><span class="p">(</span><span class="n">osthread</span><span class="p">);</span>

</code></pre></div></div>

<ul>
  <li>여기서 <code class="language-plaintext highlighter-rouge">OSThread</code>는 <strong>OS 스레드 핸들을 감싸는 HotSpot 내부 객체</strong>다.
    <ul>
      <li>pthread ID, native thread id, 시작 동기화용 모니터, 상태값 등을 가진다.</li>
    </ul>
  </li>
  <li>이 시점에는 아직 OS 스레드를 만들지 않았다.</li>
  <li>상태를 <code class="language-plaintext highlighter-rouge">ALLOCATED</code>로 두고, <code class="language-plaintext highlighter-rouge">JavaThread</code> 쪽과 연결만 해둔다.</li>
</ul>

<p>그림으로 보면:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>JavaThread
  └─ OSThread (state = ALLOCATED)
       └─ (아직 OS thread 없음)

</code></pre></div></div>

<hr>

<h2 id="5-2단계--pthread_attr_t-초기화--detach-모드-설정">5. 2단계 – <code class="language-plaintext highlighter-rouge">pthread_attr_t</code> 초기화 + detach 모드 설정</h2>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">pthread_attr_t</span> <span class="n">attr</span><span class="p">;</span>
<span class="k">if</span> <span class="p">(</span><span class="n">pthread_attr_init</span><span class="p">(</span><span class="o">&amp;</span><span class="n">attr</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
  <span class="p">...</span>
<span class="p">}</span>
<span class="n">pthread_attr_setdetachstate</span><span class="p">(</span><span class="o">&amp;</span><span class="n">attr</span><span class="p">,</span> <span class="n">PTHREAD_CREATE_DETACHED</span><span class="p">);</span>

</code></pre></div></div>

<p><code class="language-plaintext highlighter-rouge">PTHREAD_CREATE_DETACHED</code>를 쓰면 <strong>detached 스레드</strong>가 만들어진다.</p>

<ul>
  <li>
<strong>joinable 스레드 (기본값)</strong>
    <ul>
      <li>joinable 스레드를 만들면, 그 스레드가 끝나도 커널 안에 스레드 관련 정보가 남아 있다.</li>
      <li>그래서 언젠가는 <code class="language-plaintext highlighter-rouge">pthread_join(tid, NULL);</code>을 호출해 줘야 한다.
        <ul>
          <li>이때 이 스레드가 다 끝났는지 확인하고 동시에 리소스를 정리해 준다.</li>
        </ul>
      </li>
      <li>언제 쓰는가?
        <ul>
          <li>이 스레드가 언제 끝나는지 반드시 알고 싶다.</li>
          <li>이 스레드 결과를 받아서 다음 작업을 하고 싶다.</li>
          <li>스레드가 다 끝난 뒤에 프로그램을 종료하고 싶다.</li>
        </ul>
      </li>
    </ul>
  </li>
  <li>
<strong>detached 스레드</strong>
    <ul>
      <li>언제 끝났는지 직접 확인하는 용도가 아니다.</li>
      <li>스레드가 끝나는 순간, OS가 이 스레드는 끝났다 하고 바로 관련 리소스를 정리한다.</li>
      <li>그래서 나중에 <code class="language-plaintext highlighter-rouge">pthread_join(tid, ...)</code>을 부를 수 없다.</li>
      <li>이미 정리된 정보라서 더 이상 joint 대상이 아니기 때문이다.</li>
      <li>언제 쓰는가?
        <ul>
          <li>이 스레드가 언제 끝나는지 정확한 시점을 알 필요 없다.</li>
          <li>그냥 백그라운드에서 한 번 돌고 끝나면 된다.</li>
        </ul>
      </li>
    </ul>
  </li>
</ul>

<p>한 줄 요약하면:</p>

<blockquote>
  <p>joinable = “내가 직접 join해서 치우는 스레드”</p>

  <p>detached = “끝나면 OS가 알아서 치우는 스레드”</p>

</blockquote>

<hr>

<h3 id="jvm이-내부-스레드를-detached로-자주-만드는-이유">JVM이 내부 스레드를 detached로 자주 만드는 이유</h3>

<p>HotSpot JVM이 내부에서 OS 스레드를 만들 때는, 보통 이렇게 생각하면 된다.</p>

<ul>
  <li>자바 코드에서 <code class="language-plaintext highlighter-rouge">pthread_join()</code>을 직접 호출할 일은 없다.</li>
  <li>OS 스레드의 생명주기/리소스 정리는 <strong>JVM이 전체적으로 관리</strong>한다.</li>
  <li>자바 개발자는 <strong><code class="language-plaintext highlighter-rouge">Thread.join()</code> 같은 자바 API만</strong> 쓰면 된다.</li>
</ul>

<p>그래서 JVM 입장에서는:</p>

<ul>
  <li>
    <p>OS 레벨에서는 <strong>detached</strong>로 만들어 두면</p>

    <p>→ 스레드가 끝날 때 커널이 자동으로 리소스를 정리해 준다.</p>
  </li>
  <li>
    <p>자바 레벨에서는</p>

    <p>→ “저 Thread가 끝났는지”는 <code class="language-plaintext highlighter-rouge">JavaThread</code>/<code class="language-plaintext highlighter-rouge">Thread</code> 상태로 관리하고</p>

    <p>→ <code class="language-plaintext highlighter-rouge">join()</code>이 오면 wait/notify로 자바 쪽에서만 기다리도록 구현한다.</p>
  </li>
</ul>

<p>즉,</p>

<blockquote>
  <p>OS 레벨 리소스 청소 = detached + 커널</p>

  <p>자바 레벨 동기화/대기 = JVM + <code class="language-plaintext highlighter-rouge">Thread.join()</code></p>

</blockquote>

<p>으로 역할을 분리해 둔 구조라고 보면 된다.</p>

<hr>

<h3 id="java-join-vs-pthread_join-차이">Java <code class="language-plaintext highlighter-rouge">join()</code> vs <code class="language-plaintext highlighter-rouge">pthread_join()</code> 차이</h3>

<p><strong><code class="language-plaintext highlighter-rouge">pthread_join()</code> (C/POSIX)</strong></p>

<ul>
  <li>대상 OS 스레드가 끝날 때까지 <strong>현재 스레드를 블록</strong>시키고,</li>
  <li>동시에 그 스레드의 커널 리소스를 회수한다.</li>
  <li>“OS 스레드에 직접 붙어서 기다리는 함수”</li>
</ul>

<p><strong><code class="language-plaintext highlighter-rouge">Thread.join()</code> (Java)</strong></p>

<ul>
  <li>OS 함수 래핑이 아니라, <strong>JVM이 구현한 고수준 동기화 메서드</strong>다.</li>
  <li>내부적으로는
    <ul>
      <li>
<code class="language-plaintext highlighter-rouge">JavaThread</code> / 자바 <code class="language-plaintext highlighter-rouge">Thread</code>의 <strong>상태</strong>를 보고</li>
      <li>아직 안 끝났으면 <code class="language-plaintext highlighter-rouge">wait/notify</code> 패턴으로 블록시킨다.</li>
    </ul>
  </li>
  <li>OS 레벨 <code class="language-plaintext highlighter-rouge">pthread_join()</code>을 직접 호출해서 자바 스레드마다 join하는 구조가 아니다.</li>
</ul>

<p>그래서 Java 관점에서는:</p>

<blockquote>
  <p>“OS 스레드를 join한다기보다는,</p>

  <p><strong>JVM이 관리하는 ‘자바 스레드 상태’가 끝날 때까지 기다린다</strong>”</p>

</blockquote>

<hr>

<h2 id="6-3단계--스택-크기--가드-페이지-설정">6. 3단계 – 스택 크기 &amp; 가드 페이지 설정</h2>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">size_t</span> <span class="n">stack_size</span> <span class="o">=</span> <span class="n">os</span><span class="o">::</span><span class="n">Posix</span><span class="o">::</span><span class="n">get_initial_stack_size</span><span class="p">(</span><span class="n">thr_type</span><span class="p">,</span> <span class="n">req_stack_size</span><span class="p">);</span>
<span class="kt">size_t</span> <span class="n">guard_size</span> <span class="o">=</span> <span class="n">os</span><span class="o">::</span><span class="n">Linux</span><span class="o">::</span><span class="n">default_guard_size</span><span class="p">(</span><span class="n">thr_type</span><span class="p">);</span>
<span class="n">pthread_attr_setguardsize</span><span class="p">(</span><span class="o">&amp;</span><span class="n">attr</span><span class="p">,</span> <span class="n">guard_size</span><span class="p">);</span>
<span class="n">pthread_attr_setstacksize</span><span class="p">(</span><span class="o">&amp;</span><span class="n">attr</span><span class="p">,</span> <span class="n">stack_size</span><span class="p">);</span>

</code></pre></div></div>

<ul>
  <li>
<code class="language-plaintext highlighter-rouge">tack_size</code> → 이 스레드가 사용할 스택 크기를 최종 결정</li>
  <li>
<code class="language-plaintext highlighter-rouge">guard_size</code> → 스택 끝에 둘 “보호용 메모리 영역” 크기 결정</li>
  <li>둘 다 <code class="language-plaintext highlighter-rouge">pthread_attr_t</code>에 반영해서 <code class="language-plaintext highlighter-rouge">pthread_create</code>할 때 같이 넘김</li>
</ul>

<hr>

<h3 id="a-스택-크기-결정--얼마만큼-스택을-쓸지-최종-확정">A. 스택 크기 결정 – “얼마만큼 스택을 쓸지 최종 확정”</h3>

<p>스레드마다 <strong>자기만 쓰는 스택 메모리</strong>가 있다.</p>

<p>여기서 하는 일:</p>

<ol>
  <li>
    <p>자바에서 <code class="language-plaintext highlighter-rouge">new Thread(null, runnable, "t", stackSize)</code> 같은 식으로</p>

    <p>stackSize를 직접 지정했을 수도 있고, 안 했을 수도 있다.</p>
  </li>
  <li>JVM은 <code class="language-plaintext highlighter-rouge">req_stack_size</code>(요청값)와
    <ul>
      <li>JVM 기본값</li>
      <li>
        <p>OS가 허용하는 최소/최대 스택 크기</p>

        <p>를 모두 고려해서 <strong>최종 stack_size</strong>를 만든다.</p>
      </li>
    </ul>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">pthread_attr_setstacksize(&amp;attr, stack_size)</code>로</p>

    <p>“이 스레드는 이만큼 스택을 쓰겠다”고 명시해 준다.</p>
  </li>
</ol>

<p>이걸 안 하고 OS 기본값만 쓰면,</p>

<ul>
  <li>어떤 환경에서는 스택이 <strong>너무 작아서</strong> 금방 터질 수도 있고,</li>
  <li>반대로 <strong>너무 크게 잡혀서</strong> 불필요하게 메모리를 많이 점유할 수도 있다.</li>
</ul>

<p>그래서 JVM이 <strong>“JVM이 원하는 기준”에 맞춰 스택 크기를 컨트롤</strong>하는 거라고 보면 된다.</p>

<h3 id="b-가드-페이지guard-page--스택-오버플로를-잡아내기-위한-안전-장치">B. 가드 페이지(guard page) – “스택 오버플로를 잡아내기 위한 안전 장치”</h3>

<p><code class="language-plaintext highlighter-rouge">guard_size</code>는 <strong>가드 페이지 크기</strong>다.</p>

<ul>
  <li>스택의 끝 부분에 <strong>일부 페이지를 “접근 불가 메모리”로 막아 두는 것</strong>이다.</li>
  <li>코드가 스택을 너무 많이 써서 <strong>스택 끝을 넘어서면</strong>:
    <ul>
      <li>그 막아 둔 영역을 건드리게 되고</li>
      <li>
        <p>즉시 SIGSEGV(세그멘테이션 폴트)가 나면서 프로세스가 죽거나,</p>

        <p>JVM이 “스택 오버플로 발생”을 감지할 수 있게 된다.</p>
      </li>
    </ul>
  </li>
</ul>

<p>정리하면:</p>

<ul>
  <li>
    <p>가드 페이지가 있으면</p>

    <p>→ “스택 끝을 넘는 순간 바로 터져서, 문제 지점을 빨리 알 수 있다.”</p>
  </li>
  <li>
    <p>가드 페이지가 없으면</p>

    <p>→ 스택을 넘어서 다른 메모리까지 침범해 버려서</p>

    <p><strong>조용히 메모리를 망가뜨리고</strong>, 나중에 엉뚱한 곳에서 터져 디버깅이 어려워진다.</p>
  </li>
</ul>

<hr>

<h2 id="7-4단계--핵심-pthread_create-호출">7. 4단계 – 핵심: <code class="language-plaintext highlighter-rouge">pthread_create</code> 호출</h2>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">pthread_t</span> <span class="n">tid</span><span class="p">;</span>
<span class="kt">int</span> <span class="n">ret</span> <span class="o">=</span> <span class="n">pthread_create</span><span class="p">(</span><span class="o">&amp;</span><span class="n">tid</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">attr</span><span class="p">,</span>
                         <span class="p">(</span><span class="kt">void</span><span class="o">*</span> <span class="p">(</span><span class="o">*</span><span class="p">)(</span><span class="kt">void</span><span class="o">*</span><span class="p">))</span> <span class="n">thread_native_entry</span><span class="p">,</span>
                         <span class="kr">thread</span><span class="p">);</span>
</code></pre></div></div>

<p>여기가 “새 OS 스레드 하나 주세요”라고 OS에 요청하는 부분이다.</p>

<ul>
  <li>
    <p>첫 번째 인자 <code class="language-plaintext highlighter-rouge">&amp;tid</code></p>

    <p>→ 새로 만들어지는 스레드의 pthread ID를 돌려받을 변수 주소</p>

    <p>→ <code class="language-plaintext highlighter-rouge">pthread_create</code>가 성공하면 이 변수에 새 스레드 ID를 넣어 준다.</p>
  </li>
  <li>
    <p>두 번째 인자 <code class="language-plaintext highlighter-rouge">&amp;attr</code></p>

    <p>→ 방금 설정한 스택/가드/detach 속성.</p>

    <p>→ 이걸 넘기면 OS가 이 옵션대로 스레드를 만든다.</p>
  </li>
  <li>
    <p>세 번째 인자 <code class="language-plaintext highlighter-rouge">thread_native_entry</code></p>

    <p>→ <strong>새 스레드가 시작하면 제일 먼저 실행할 함수 주소</strong></p>

    <ul>
      <li>OS 입장에서는 새 스레드를 만들고, 그 스레드에서 이 함수를 호출하게 한다.</li>
      <li>이 함수 안에서  JVM이 초기화 작업을 하고, 자바 쪽 <code class="language-plaintext highlighter-rouge">Thread.run()</code>까지 연결해 준다.</li>
    </ul>
  </li>
  <li>
    <p>네 번째 인자 <code class="language-plaintext highlighter-rouge">thread</code></p>

    <p>→ start routine에 전달할 인자 (여기서는 <code class="language-plaintext highlighter-rouge">Thread*</code>, 보통 <code class="language-plaintext highlighter-rouge">JavaThread*</code>).</p>
  </li>
</ul>

<p><code class="language-plaintext highlighter-rouge">thread_native_entry</code>는 HotSpot 안에 정의된 함수로,</p>

<p><strong>새로 생성된 OS 스레드가 바로 들어가는 C 함수</strong>다. (이건 Part 4에서 깊게 본다.)</p>

<h3 id="7-1-실패-처리">7-1. 실패 처리</h3>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">pthread_attr_destroy</span><span class="p">(</span><span class="o">&amp;</span><span class="n">attr</span><span class="p">);</span>

<span class="k">if</span> <span class="p">(</span><span class="n">ret</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
  <span class="kr">thread</span><span class="o">-&gt;</span><span class="n">set_osthread</span><span class="p">(</span><span class="nb">nullptr</span><span class="p">);</span>
  <span class="k">delete</span> <span class="n">osthread</span><span class="p">;</span>
  <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
<span class="p">}</span>

</code></pre></div></div>

<ul>
  <li>스레드 생성이 실패하면:
    <ul>
      <li>
<code class="language-plaintext highlighter-rouge">osthread</code>를 정리하고</li>
      <li>
        <p><code class="language-plaintext highlighter-rouge">false</code> 를 반환해서 상위(<code class="language-plaintext highlighter-rouge">JavaThread</code> → <code class="language-plaintext highlighter-rouge">JVM_StartThread</code>)에서</p>

        <p><code class="language-plaintext highlighter-rouge">OutOfMemoryError("Failed to create native thread")</code> 를 던질 수 있도록 한다.</p>

        <div class="language-cpp highlighter-rouge">
<div class="highlight"><pre class="highlight"><code>  <span class="c1">// JVM_StartThread() 메서드 내 코드</span>
     <span class="n">JavaThread</span><span class="o">*</span> <span class="n">native_thread</span> <span class="o">=</span> <span class="nb">nullptr</span><span class="p">;</span>
     <span class="p">...</span>
     <span class="p">...</span>
     <span class="k">if</span> <span class="p">(</span><span class="n">native_thread</span><span class="o">-&gt;</span><span class="n">osthread</span><span class="p">()</span> <span class="o">==</span> <span class="nb">nullptr</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">THROW_MSG</span><span class="p">(</span><span class="n">vmSymbols</span><span class="o">::</span><span class="n">java_lang_OutOfMemoryError</span><span class="p">(),</span> <span class="s">"Failed to create native thread"</span><span class="p">);</span>
     <span class="p">}</span>
</code></pre></div>        </div>
      </li>
    </ul>
  </li>
</ul>

<hr>

<h2 id="8-5단계--성공한-경우-osthread에-pthread-id-기록--자식-초기화-대기">8. 5단계 – 성공한 경우: <code class="language-plaintext highlighter-rouge">OSThread</code>에 pthread ID 기록 + 자식 초기화 대기</h2>

<p>스레드 생성이 성공했다면:</p>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">osthread</span><span class="o">-&gt;</span><span class="n">set_pthread_id</span><span class="p">(</span><span class="n">tid</span><span class="p">);</span>
</code></pre></div></div>

<ul>
  <li>
<code class="language-plaintext highlighter-rouge">OSThread</code>에 pthread ID를 기록한다.</li>
  <li>디버깅/로그/시그널 라우팅 등에 사용된다.</li>
</ul>

<p>그리고 바로 <strong>자식(새 스레드)의 초기화를 기다리는 단계</strong>로 들어간다.</p>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span>
  <span class="n">Monitor</span><span class="o">*</span> <span class="n">sync_with_child</span> <span class="o">=</span> <span class="n">osthread</span><span class="o">-&gt;</span><span class="n">startThread_lock</span><span class="p">();</span>
  <span class="n">MutexLocker</span> <span class="n">ml</span><span class="p">(</span><span class="n">sync_with_child</span><span class="p">,</span> <span class="n">Mutex</span><span class="o">::</span><span class="n">_no_safepoint_check_flag</span><span class="p">);</span>
  <span class="k">while</span> <span class="p">(</span><span class="n">osthread</span><span class="o">-&gt;</span><span class="n">get_state</span><span class="p">()</span> <span class="o">==</span> <span class="n">ALLOCATED</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">sync_with_child</span><span class="o">-&gt;</span><span class="n">wait_without_safepoint_check</span><span class="p">();</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>여기서 중요한 포인트:</p>

<ul>
  <li>부모(현재 <code class="language-plaintext highlighter-rouge">os::create_thread</code>를 실행 중인 스레드)는
    <ul>
      <li>
<code class="language-plaintext highlighter-rouge">startThread_lock</code> 라는 모니터(뮤텍스 + 조건변수)를 잡고,</li>
      <li>
<code class="language-plaintext highlighter-rouge">OSThread</code> 상태가 <code class="language-plaintext highlighter-rouge">ALLOCATED</code> 에서 다른 상태로 바뀔 때까지 기다린다.</li>
    </ul>
  </li>
  <li>자식(새로 만들어진 OS 스레드)은
    <ul>
      <li>
<code class="language-plaintext highlighter-rouge">thread_native_entry</code> 안에서 초기화 작업을 수행한 뒤,</li>
      <li>
<code class="language-plaintext highlighter-rouge">OSThread</code> 상태를 <code class="language-plaintext highlighter-rouge">INITIALIZED</code> 등으로 바꾸고,</li>
      <li>같은 <code class="language-plaintext highlighter-rouge">startThread_lock</code> 모니터에서 <code class="language-plaintext highlighter-rouge">notify()</code>를 호출해 부모를 깨운다.</li>
    </ul>
  </li>
</ul>

<p>즉, 이 단계는:</p>

<blockquote>
  <p>“스레드는 이미 만들어졌는데,</p>

  <p>자식이 최소한의 VM 초기화(<code class="language-plaintext highlighter-rouge">OSThread</code> 상태 세팅 등)를 끝낼 때까지</p>

  <p>부모가 잠깐 기다리는 구간”</p>

</blockquote>

<p>이라고 보면 된다.</p>

<p>자식이 <code class="language-plaintext highlighter-rouge">INITIALIZED</code> 상태까지 올라간 뒤에야</p>

<p>상위에서 <code class="language-plaintext highlighter-rouge">Thread::start</code> → <code class="language-plaintext highlighter-rouge">os::start_thread</code> → <code class="language-plaintext highlighter-rouge">pd_start_thread</code> 를 호출하여</p>

<p><strong>실제 <code class="language-plaintext highlighter-rouge">RUNNABLE</code> 상태로 전환</strong>시킬 수 있다.</p>

<p>(이 start barrier와 핸드셰이크 세부 내용은 Part 4에서 연결된다.)</p>

<hr>

<h2 id="9-glibc란-무엇이고-왜-pthread_create를-쓰는가">9. glibc란 무엇이고, 왜 <code class="language-plaintext highlighter-rouge">pthread_create</code>를 쓰는가?</h2>

<p>지금까지는 HotSpot 코드 레벨이었다.</p>

<p>하지만 <code class="language-plaintext highlighter-rouge">pthread_create</code> 자체도 “사용자 공간 라이브러리 함수”다.</p>

<p>한 단계 더 내려가보자.</p>

<h3 id="9-1-glibc--gnu-c-library">9-1. glibc = GNU C Library</h3>

<ul>
  <li>리눅스에서 가장 널리 쓰이는 <strong>표준 C 라이브러리 구현</strong>.</li>
  <li>우리가 C에서 쓰는 대부분의 함수:
    <ul>
      <li>
<code class="language-plaintext highlighter-rouge">printf</code>, <code class="language-plaintext highlighter-rouge">malloc</code>, <code class="language-plaintext highlighter-rouge">free</code>
</li>
      <li>
<code class="language-plaintext highlighter-rouge">open</code>, <code class="language-plaintext highlighter-rouge">read</code>, <code class="language-plaintext highlighter-rouge">write</code>
</li>
      <li>
        <p><code class="language-plaintext highlighter-rouge">pthread_create</code>, <code class="language-plaintext highlighter-rouge">pthread_join</code></p>

        <p>전부 glibc 안에 들어 있다.</p>
      </li>
    </ul>
  </li>
</ul>

<p>역할:</p>

<ul>
  <li>각종 시스템 콜(syscall)을 감싸서 <strong>이식성 있고 쓰기 편한 API</strong>를 제공한다.</li>
  <li>직접 <code class="language-plaintext highlighter-rouge">syscall</code> 어셈블리로 호출하는 대신,
    <ul>
      <li>glibc 함수 하나로 OS 의존성을 숨기고,</li>
      <li>POSIX/ISO C 표준 인터페이스를 맞춰준다.</li>
    </ul>
  </li>
</ul>

<h3 id="9-2-jvm이-clone을-직접-호출하지-않고-pthread_create를-쓰는-이유">9-2. JVM이 <code class="language-plaintext highlighter-rouge">clone()</code>을 직접 호출하지 않고 <code class="language-plaintext highlighter-rouge">pthread_create</code>를 쓰는 이유</h3>

<p>리눅스 커널에서 스레드/프로세스를 만드는 시스템콜은 <code class="language-plaintext highlighter-rouge">clone()</code> 이다.</p>

<p>그런데 HotSpot은 대부분 이걸 직접 쓰지 않고, <strong><code class="language-plaintext highlighter-rouge">pthread_create</code></strong> 를 사용한다.</p>

<p>이유:</p>

<ol>
  <li>POSIX 호환
    <ul>
      <li>
<code class="language-plaintext highlighter-rouge">pthread</code> API는 POSIX 표준에 맞게 설계되어 있고,</li>
      <li>다른 유닉스 계열 OS에서도 거의 동일하게 동작한다.</li>
    </ul>
  </li>
  <li>이식성
    <ul>
      <li>JVM은 여러 유닉스 계열(리눅스, BSD, macOS 등)을 지원해야 한다.</li>
      <li>
        <p>각각의 커널 syscall을 직접 다루는 것보다는</p>

        <p><code class="language-plaintext highlighter-rouge">pthread_*</code> 계열 API 위에 얹는 게 훨씬 유지보수에 좋다.</p>
      </li>
    </ul>
  </li>
  <li>추가 편의 기능
    <ul>
      <li>
<code class="language-plaintext highlighter-rouge">pthread_create</code>는 단순히 <code class="language-plaintext highlighter-rouge">clone()</code>만 감싸는 게 아니라,
        <ul>
          <li>스레드 속성,</li>
          <li>signal mask,</li>
          <li>
            <p>TLS 초기화 등</p>

            <p>여러 준비 작업을 함께 처리해 준다.</p>
          </li>
        </ul>
      </li>
    </ul>
  </li>
</ol>

<p>정리하면:</p>

<blockquote>
  <p>HotSpot(유저 공간 프로그램)이 OS 스레드를 만들 때</p>

  <p>glibc가 제공하는 <code class="language-plaintext highlighter-rouge">pthread_create</code>를 사용하고,</p>

  <p>glibc는 내부에서 <code class="language-plaintext highlighter-rouge">clone()</code> 시스템콜로 커널에 요청한다.</p>

</blockquote>

<hr>

<h2 id="10-커널-레벨--clone-시스템콜과-task_struct">10. 커널 레벨 – <code class="language-plaintext highlighter-rouge">clone()</code> 시스템콜과 task_struct</h2>

<p>이제 마지막 레벨, 리눅스 커널.</p>

<h3 id="10-1-clone-시스템콜">10-1. <code class="language-plaintext highlighter-rouge">clone()</code> 시스템콜</h3>

<ul>
  <li>리눅스에서 <strong>프로세스/스레드 생성</strong>에 쓰이는 시스템콜이다.</li>
  <li>
<code class="language-plaintext highlighter-rouge">fork()</code>와 달리, 어떤 자원을 부모와 공유할지 플래그로 지정할 수 있다.
    <ul>
      <li>
<code class="language-plaintext highlighter-rouge">CLONE_VM</code> → 주소 공간 공유 (스레드)</li>
      <li>
<code class="language-plaintext highlighter-rouge">CLONE_FILES</code> → 열린 파일 디스크립터 공유</li>
      <li>
<code class="language-plaintext highlighter-rouge">CLONE_SIGHAND</code> → 시그널 핸들 공유</li>
    </ul>
  </li>
  <li>
    <p>일반적인 POSIX 스레드 구현에서는 이 플래그들을 적절히 조합해</p>

    <p>“<strong>같은 프로세스 안에서 주소 공간을 공유하는 스레드</strong>”를 만든다.</p>
  </li>
</ul>

<h3 id="10-2-커널-내부에서-하는-일-개념적으로">10-2. 커널 내부에서 하는 일 (개념적으로)</h3>

<ol>
  <li>새 <code class="language-plaintext highlighter-rouge">task_struct</code> 할당
    <ul>
      <li>리눅스 커널에서 스레드/프로세스를 나타내는 구조체.</li>
    </ul>
  </li>
  <li>부모의 주소 공간, 파일, 시그널 핸들 등을 공유/복사할지 플래그에 따라 처리.</li>
  <li>스택/레지스터 초기값 세팅</li>
  <li>스케줄러 큐에 새 task 등록</li>
</ol>

<p>그리고:</p>

<ul>
  <li>시스템콜이 성공하면 부모 쪽에는 새 스레드 ID를 반환하고,</li>
  <li>자식 쪽에서는 지정된 start routine의 첫 줄부터 실행을 시작한다.</li>
</ul>

<hr>

<h2 id="11-세-레벨-요약-hotspot--glibc--커널">11. 세 레벨 요약: HotSpot ↔ glibc ↔ 커널</h2>

<p>지금까지의 흐름을 한 번에 정리하면:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[HotSpot 레벨]  (OpenJDK / libjvm.so)
---------------------------------------
JVM_StartThread
  → new JavaThread(thread_entry, stackSize)
      → os::create_thread(this, thr_type, stackSize)
          → pthread_attr_init / setstacksize / setguardsize
          → pthread_create(&amp;tid, &amp;attr, thread_native_entry, thread)
              ↓

[glibc 레벨]    (libpthread.so / glibc)
---------------------------------------
pthread_create(...)
  → clone(...) 시스템콜 래퍼
      ↓

[커널 레벨]     (Linux kernel)
---------------------------------------
clone(...)
  → task_struct 생성
  → 주소 공간/파일/시그널 공유 설정
  → 스케줄러에 새 스레드 등록
  → 새 스레드에서 start routine(thread_native_entry) 실행 시작

</code></pre></div></div>

<p>이렇게 보면, 우리가 자바에서 친 <strong><code class="language-plaintext highlighter-rouge">t.start()</code> 한 줄</strong>이:</p>

<ol>
  <li>JVM C++ 코드 (<code class="language-plaintext highlighter-rouge">JavaThread</code>, <code class="language-plaintext highlighter-rouge">OSThread</code>)</li>
  <li>glibc (<code class="language-plaintext highlighter-rouge">pthread_create</code>)</li>
  <li>리눅스 커널 (<code class="language-plaintext highlighter-rouge">clone</code>, <code class="language-plaintext highlighter-rouge">task_struct</code>, 스케줄러)</li>
</ol>

<p>를 층층이 타고 내려가면서 OS 스레드를 만드는 동작이라는 게 보인다.</p>

<p>Part 3는 이 중에서 “HotSpot → glibc → 커널로 내려가는 과정”까지.</p>

<p>Part 4에서는 새로 만들어진 스레드가</p>

<p><code class="language-plaintext highlighter-rouge">thread_native_entry</code> → <code class="language-plaintext highlighter-rouge">JavaThread::run</code> → <code class="language-plaintext highlighter-rouge">thread_entry</code> → <code class="language-plaintext highlighter-rouge">Thread.run()</code> 으로</p>

<p><strong>다시 자바 세계로 올라오는 길</strong>을 따라갈 예정이다.</p>

<hr>

<h2 id="12-part-3-정리">12. Part 3 정리</h2>

<p>핵심만 다시 뽑으면:</p>

<ol>
  <li>
<code class="language-plaintext highlighter-rouge">JavaThread</code> 생성자에서 <code class="language-plaintext highlighter-rouge">os::create_thread(this, thr_type, stackSize)</code> 호출</li>
  <li>
<code class="language-plaintext highlighter-rouge">os::create_thread</code> (Linux 기준):
    <ul>
      <li>
<code class="language-plaintext highlighter-rouge">OSThread</code> 객체 생성, 상태 <code class="language-plaintext highlighter-rouge">ALLOCATED</code>
</li>
      <li>
<code class="language-plaintext highlighter-rouge">pthread_attr_t</code> 초기화, detach 모드 설정</li>
      <li>스택 크기, 가드 페이지 설정</li>
      <li>
<code class="language-plaintext highlighter-rouge">pthread_create(&amp;tid, &amp;attr, thread_native_entry, thread)</code> 호출</li>
      <li>성공 시 <code class="language-plaintext highlighter-rouge">OSThread</code>에 pthread ID 저장</li>
      <li>
<code class="language-plaintext highlighter-rouge">startThread_lock</code> 모니터로 자식 스레드 초기화 완료까지 대기</li>
    </ul>
  </li>
  <li>
<code class="language-plaintext highlighter-rouge">pthread_create</code>는 glibc 함수로, 내부에서 <code class="language-plaintext highlighter-rouge">clone()</code> 시스템콜을 호출</li>
  <li>
    <p>리눅스 커널은 <code class="language-plaintext highlighter-rouge">clone()</code>을 통해 새 <code class="language-plaintext highlighter-rouge">task_struct</code>를 만들고,</p>

    <p>스케줄러에 등록한 뒤, 새 스레드에서 <code class="language-plaintext highlighter-rouge">thread_native_entry</code>를 실행 시작</p>
  </li>
  <li>
    <p>이렇게 해서 자바의 <code class="language-plaintext highlighter-rouge">Thread</code> 객체는</p>

    <p>JVM 내부 <code class="language-plaintext highlighter-rouge">JavaThread</code> ↔ <code class="language-plaintext highlighter-rouge">OSThread</code> ↔ OS 커널 스레드와 1:1로 연결된다 (플랫폼 스레드 기준).</p>
  </li>
</ol>

    <!-- see https://giscus.app/ -->
    <div class="giscus" id="giscus" style="margin: 4rem auto;"></div>
    <div id="related-box">
        <span>
            <svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 512 512"><path d="M278.5 215.6L23 471c-9.4 9.4-9.4 24.6 0 33.9s24.6 9.4 33.9 0l74.8-74.8c7.4 4.6 15.3 8.2 23.8 10.5C200.3 452.8 270 454.5 338 409.4c12.2-8.1 5.8-25.4-8.8-25.4l-16.1 0c-5.1 0-9.2-4.1-9.2-9.2c0-4.1 2.7-7.6 6.5-8.8l97.7-29.3c3.4-1 6.4-3.1 8.4-6.1c4.4-6.4 8.6-12.9 12.6-19.6c6.2-10.3-1.5-23-13.5-23l-38.6 0c-5.1 0-9.2-4.1-9.2-9.2c0-4.1 2.7-7.6 6.5-8.8l80.9-24.3c4.6-1.4 8.4-4.8 10.2-9.3C494.5 163 507.8 86.1 511.9 36.8c.8-9.9-3-19.6-10-26.6s-16.7-10.8-26.6-10C391.5 7 228.5 40.5 137.4 131.6C57.3 211.7 56.7 302.3 71.3 356.4c2.1 7.9 12 9.6 17.8 3.8L253.6 195.8c6.2-6.2 16.4-6.2 22.6 0c5.4 5.4 6.1 13.6 2.2 19.8z"></path></svg>
            You May Also Like
        </span>
        <ul id="related-posts"></ul>
    </div>
</main>
<div class="top-arrow">
    <svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 384 512"><path d="M214.6 41.4c-12.5-12.5-32.8-12.5-45.3 0l-160 160c-12.5 12.5-12.5 32.8 0 45.3s32.8 12.5 45.3 0L160 141.2V448c0 17.7 14.3 32 32 32s32-14.3 32-32V141.2L329.4 246.6c12.5 12.5 32.8 12.5 45.3 0s12.5-32.8 0-45.3l-160-160z"></path></svg>
</div>
                
            </div>
        </div>
        <div id="search">
    <div class="wave"></div>
    <div class="wave"></div>
    <div class="wave"></div>

    <div class="search-box">
        <mark>Touch background to close</mark>
        <div class="input-box">
            <input id="search-input" type="search" tabindex="1" spellcheck="false" placeholder="Search...">
            <button id="btn-clear">
                <svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 384 512"><path d="M342.6 150.6c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0L192 210.7 86.6 105.4c-12.5-12.5-32.8-12.5-45.3 0s-12.5 32.8 0 45.3L146.7 256 41.4 361.4c-12.5 12.5-12.5 32.8 0 45.3s32.8 12.5 45.3 0L192 301.3 297.4 406.6c12.5 12.5 32.8 12.5 45.3 0s12.5-32.8 0-45.3L237.3 256 342.6 150.6z"></path></svg>
            </button>
        </div>
        <ul id="search-result"></ul>
    </div>
</div>
    </body>
    <script defer src="/assets/js/background.js"></script>
<script defer src="https://www.googletagmanager.com/gtag/js?id="></script>
<script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){ dataLayer.push(arguments); }

    gtag('js', new Date());
    gtag('config', '');
</script>
    
        <script src="/assets/js/post.js"></script>
        <link rel="preload" href="/assets/css/highlight.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
        <noscript><link rel="stylesheet" href="/assets/css/highlight.min.css"></noscript>
        <script defer src="/assets/js/highlight.min.js"></script>
    
    <script src="/assets/js/common.js"></script>

    <script defer>
    var posts = [];

    

        posts.push({
            'title'    : "Index",
            'path'     : "Java",
            'type'     : "category",
            'tags'     : "",
            'url'      : "/Java/index.html",
            'image'    : "/assets/img/thumbnail/empty.jpg",
            'date'     : "1900-01-01"
        });
    

        posts.push({
            'title'    : "Index",
            'path'     : "Spring Boot > Security",
            'type'     : "category",
            'tags'     : "",
            'url'      : "/Spring%20Boot/Security/index.html",
            'image'    : "/assets/img/thumbnail/empty.jpg",
            'date'     : "1900-01-01"
        });
    

        posts.push({
            'title'    : "Index",
            'path'     : "Spring Boot",
            'type'     : "category",
            'tags'     : "",
            'url'      : "/Spring%20Boot/index.html",
            'image'    : "/assets/img/thumbnail/empty.jpg",
            'date'     : "1900-01-01"
        });
    

        posts.push({
            'title'    : "Index",
            'path'     : "System Architecture > api-design",
            'type'     : "category",
            'tags'     : "",
            'url'      : "/System%20Architecture/api-design/index.html",
            'image'    : "/assets/img/thumbnail/empty.jpg",
            'date'     : "1900-01-01"
        });
    

        posts.push({
            'title'    : "Index",
            'path'     : "System Architecture > data-modeling-erd",
            'type'     : "category",
            'tags'     : "",
            'url'      : "/System%20Architecture/data-modeling-erd/index.html",
            'image'    : "/assets/img/thumbnail/empty.jpg",
            'date'     : "1900-01-01"
        });
    

        posts.push({
            'title'    : "Index",
            'path'     : "System Architecture",
            'type'     : "category",
            'tags'     : "",
            'url'      : "/System%20Architecture/index.html",
            'image'    : "/assets/img/thumbnail/empty.jpg",
            'date'     : "1900-01-01"
        });
    

        posts.push({
            'title'    : "Index",
            'path'     : "System Architecture > security-auth",
            'type'     : "category",
            'tags'     : "",
            'url'      : "/System%20Architecture/security-auth/index.html",
            'image'    : "/assets/img/thumbnail/empty.jpg",
            'date'     : "1900-01-01"
        });
    

        posts.push({
            'title'    : "Index",
            'path'     : "System Architecture > system-design",
            'type'     : "category",
            'tags'     : "",
            'url'      : "/System%20Architecture/system-design/index.html",
            'image'    : "/assets/img/thumbnail/empty.jpg",
            'date'     : "1900-01-01"
        });
    

        posts.push({
            'title'    : "Index",
            'path'     : "Trouble Shooting",
            'type'     : "category",
            'tags'     : "",
            'url'      : "/Trouble%20Shooting/index.html",
            'image'    : "/assets/img/thumbnail/empty.jpg",
            'date'     : "1900-01-01"
        });
    

        posts.push({
            'title'    : "Index",
            'path'     : "",
            'type'     : "category",
            'tags'     : "",
            'url'      : "/index.html",
            'image'    : "/assets/img/thumbnail/empty.jpg",
            'date'     : "1900-01-01"
        });
    

        posts.push({
            'title'    : "[Java Concurrency] Thread.start()와 Thread 객체의 모니터 락 획득 과정",
            'path'     : "Java",
            'type'     : "post",
            'tags'     : "java, Concurrency, monitor lock, thread, synchronized",
            'url'      : "/Java/thread-monitor-lock-1.html",
            'image'    : "",
            'date'     : "2025-09-26"
        });
    

        posts.push({
            'title'    : "[Java Concurrency] 모니터 락과 wait/notifyAll로 턴 스케줄러 구현하기",
            'path'     : "Java",
            'type'     : "post",
            'tags'     : "java, Concurrency, monitor lock, wait-notifyAll",
            'url'      : "/Java/monitor-lock-1.html",
            'image'    : "",
            'date'     : "2025-09-30"
        });
    

        posts.push({
            'title'    : "[Java Multithreading] Part 1 – Thread.start() vs run() : 자바 코드 + 간단한 흐름 비교",
            'path'     : "Java",
            'type'     : "post",
            'tags'     : "java, concurrency, thread, start, run, jvm",
            'url'      : "/Java/java-thread-start-part1-start-vs-run-code-and-flow.html",
            'image'    : "",
            'date'     : "2025-10-02"
        });
    

        posts.push({
            'title'    : "[Java Multithreading] Part 2 – Thread.start() 뒤에서 일어나는 일: registerNatives ~ JVM_StartThread ~ JavaThread",
            'path'     : "Java",
            'type'     : "post",
            'tags'     : "java, concurrency, thread, start, run, jvm",
            'url'      : "/Java/java-thread-start-part2-start0-jvm-startthread-javathread.html",
            'image'    : "",
            'date'     : "2025-10-03"
        });
    

        posts.push({
            'title'    : "[Java Multithreading] Part 3 – JVM이 OS 스레드를 만드는 과정: JavaThread, os::create_thread, pthread_create, glibc, clone()",
            'path'     : "Java",
            'type'     : "post",
            'tags'     : "java, concurrency, thread, start, run, jvm",
            'url'      : "/Java/java-thread-start-part3-os-create-thread-pthread-glibc-clone.html",
            'image'    : "",
            'date'     : "2025-10-04"
        });
    

        posts.push({
            'title'    : "[Java Multithreading] Part 4 – 새로운 스레드가 자바 run()에 도달하기까지: thread_native_entry → JavaThread::run → thread_entry → Thread.run()",
            'path'     : "Java",
            'type'     : "post",
            'tags'     : "java, concurrency, thread, start, run, jvm",
            'url'      : "/Java/java-thread-start-part4-thread-entry-to-run.html",
            'image'    : "",
            'date'     : "2025-10-04"
        });
    

        posts.push({
            'title'    : "[Java Multithreading] 마지막 글 - 스레드 관점에서 한눈에 정리: new → start → run → 종료 후 상태",
            'path'     : "Java",
            'type'     : "post",
            'tags'     : "java, concurrency, thread, start, run, jvm",
            'url'      : "/Java/java-thread-start-part5-thread-lifecycle-summary.html",
            'image'    : "",
            'date'     : "2025-10-06"
        });
    

        posts.push({
            'title'    : "[Firebase/Java] Firestore ApiFuture와 Java Future, 그리고 Reactor Mono까지 – 비동기 흐름 뜯어보기",
            'path'     : "Java",
            'type'     : "post",
            'tags'     : "java, firestore, apifuture, future, listenablefuture, reactor, mono, async, concurrency",
            'url'      : "/Java/firestore-apifuture-future-mono-async-flow.html",
            'image'    : "",
            'date'     : "2025-10-25"
        });
    

        posts.push({
            'title'    : "[시스템 설계] 하루 한 번 알림을 “누락 없이” 보내기 위한 Redis 큐 &amp; 워커 설계",
            'path'     : "System Architecture > system-design",
            'type'     : "post",
            'tags'     : "redis, worker, at-least-once-notification, spring schedule, blmove, redis-queue-blmove-idempotency",
            'url'      : "/System%20Architecture/system-design/at-least-once-notification-redis-queue-blmove-idempotency.html",
            'image'    : "/assets/img/thumbnail/at-least-once-notification-redis-queue-blmove-idempotency.png",
            'date'     : "2025-11-03"
        });
    

        posts.push({
            'title'    : "카카오 OAuth 로그인 흐름 이해하기: JS SDK + Authorization Code 플로우",
            'path'     : "System Architecture > security-auth",
            'type'     : "post",
            'tags'     : "springboot, spring-security, oauth2, kakao, login, diagram",
            'url'      : "/System%20Architecture/security-auth/2025-11-30-kakao-login.html",
            'image'    : "/assets/img/thumbnail/kakao-oauth-login.png",
            'date'     : "2025-11-30"
        });
    

    searchPost(posts);

    
        searchRelated(posts);
    
</script>
    <script type="module">
        import mermaid from "https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.esm.min.mjs";
        document.addEventListener("DOMContentLoaded", function () {
            mermaid.initialize({ startOnLoad: true });
        });
    </script>
</html>
