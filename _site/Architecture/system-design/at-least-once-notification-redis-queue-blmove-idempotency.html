<!DOCTYPE html>
<html lang="en">
    <head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
        <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>
    
        [시스템 설계] 하루 한 번 알림을 “누락 없이” 보내기 위한 Redis 큐 &amp; 워커 설계
    
</title>
<!-- Begin Jekyll SEO tag v2.8.0 -->
<title>[시스템 설계] 하루 한 번 알림을 “누락 없이” 보내기 위한 Redis 큐 &amp; 워커 설계 | Gimin’s Blog</title>
<meta name="generator" content="Jekyll v4.4.1">
<meta property="og:title" content="[시스템 설계] 하루 한 번 알림을 “누락 없이” 보내기 위한 Redis 큐 &amp; 워커 설계">
<meta property="og:locale" content="en_US">
<meta name="description" content="[시스템 설계] 하루 한 번 알림을 “누락 없이” 보내기 위한 Redis 큐 &amp; 워커 설계">
<meta property="og:description" content="[시스템 설계] 하루 한 번 알림을 “누락 없이” 보내기 위한 Redis 큐 &amp; 워커 설계">
<link rel="canonical" href="http://localhost:4000/Architecture/system-design/at-least-once-notification-redis-queue-blmove-idempotency.html">
<meta property="og:url" content="http://localhost:4000/Architecture/system-design/at-least-once-notification-redis-queue-blmove-idempotency.html">
<meta property="og:site_name" content="Gimin’s Blog">
<meta property="og:type" content="article">
<meta property="article:published_time" content="2025-11-03T23:32:00+09:00">
<meta name="twitter:card" content="summary">
<meta property="twitter:title" content="[시스템 설계] 하루 한 번 알림을 “누락 없이” 보내기 위한 Redis 큐 &amp; 워커 설계">
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2025-11-03T23:32:00+09:00","datePublished":"2025-11-03T23:32:00+09:00","description":"[시스템 설계] 하루 한 번 알림을 “누락 없이” 보내기 위한 Redis 큐 &amp; 워커 설계","headline":"[시스템 설계] 하루 한 번 알림을 “누락 없이” 보내기 위한 Redis 큐 &amp; 워커 설계","mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/Architecture/system-design/at-least-once-notification-redis-queue-blmove-idempotency.html"},"url":"http://localhost:4000/Architecture/system-design/at-least-once-notification-redis-queue-blmove-idempotency.html"}</script>
<!-- End Jekyll SEO tag -->


<link rel="shortcut icon" type="image/png" href="/assets/img/favicon.webp">
<style>
@font-face {
    font-family: 'Nunito Sans';
    font-style: normal;
    font-weight: 400;
    font-display: optional;
    src: local('Nunito Sans'),
         url("/assets/fonts/NunitoSans-Regular.woff2") format("woff2");
}

@font-face {
    font-family: 'Righteous';
    font-style: normal;
    font-weight: 600;
    font-display: optional;
    src: local('Righteous'),
         url("/assets/fonts/Righteous-Regular.woff2") format("woff2");
}

@font-face {
    font-family: 'Lato';
    font-style: normal;
    font-weight: 400;
    font-display: optional;
    src: local('Lato'),
         url("/assets/fonts/Lato-Regular.woff2") format("woff2");
}
</style>

<script src="/assets/js/fontfaceobserver.js" type="text/javascript"></script>
<script type="text/javascript">
    const nunitoObserver = new FontFaceObserver('Nunito Sans');
    const righteousObserver = new FontFaceObserver('Righteous');
    const latoObserver = new FontFaceObserver('Lato');
  
    Promise.all([
        nunitoObserver.load(),
        righteousObserver.load(),
        latoObserver.load(),
    ]).then(function(){
        document.documentElement.className += " fonts-loaded";
    });
</script>

<meta name="baseurl" content="">
<meta name="description" content="시스템 설계와 깊게 공부하는 것을 좋아하는 개발자의 블로그입니다.">
        <link rel="preload" href="/assets/img/profile.jpg" as="image">
        <link rel="stylesheet" href="/assets/css/style.css">
        
            

            <meta name="giscus_repo" content="">
            <meta name="giscus_repoId" content="">
            <meta name="giscus_category" content="">
            <meta name="giscus_categoryId" content="">

            
                <style>
                        .thumbnail {
                            background-image: url("/assets/img/thumbnail/at-least-once-notification-redis-queue-blmove-idempotency.png");
                        }
                    
                </style>
            
        
    </head>
    <body>
        <script type="text/javascript">
            let currentTheme = localStorage.getItem('theme');
        
            document.body.classList[currentTheme === 'dark' ? 'add' : 'remove']('dark-theme');
        </script>
        <canvas id="stars" width="100%" height="100%"></canvas>
        <div class="sidebar sidebar-left">
    <div class="side-banner">
        <h1 class="site-tab">
            <a href="/" class="site-name">
                <img src="/assets/img/icon/house.webp" alt="" loading="lazy">
                <mark>Gimin's Blog</mark>
            </a>
            <button id="btn-brightness" aria-label="brightness-button">
                <svg class="ico-dark" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 384 512"><path d="M223.5 32C100 32 0 132.3 0 256S100 480 223.5 480c60.6 0 115.5-24.2 155.8-63.4c5-4.9 6.3-12.5 3.1-18.7s-10.1-9.7-17-8.5c-9.8 1.7-19.8 2.6-30.1 2.6c-96.9 0-175.5-78.8-175.5-176c0-65.8 36-123.1 89.3-153.3c6.1-3.5 9.2-10.5 7.7-17.3s-7.3-11.9-14.3-12.5c-6.3-.5-12.6-.8-19-.8z"></path></svg>
                <svg class="ico-light" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 512 512"><path d="M361.5 1.2c5 2.1 8.6 6.6 9.6 11.9L391 121l107.9 19.8c5.3 1 9.8 4.6 11.9 9.6s1.5 10.7-1.6 15.2L446.9 256l62.3 90.3c3.1 4.5 3.7 10.2 1.6 15.2s-6.6 8.6-11.9 9.6L391 391 371.1 498.9c-1 5.3-4.6 9.8-9.6 11.9s-10.7 1.5-15.2-1.6L256 446.9l-90.3 62.3c-4.5 3.1-10.2 3.7-15.2 1.6s-8.6-6.6-9.6-11.9L121 391 13.1 371.1c-5.3-1-9.8-4.6-11.9-9.6s-1.5-10.7 1.6-15.2L65.1 256 2.8 165.7c-3.1-4.5-3.7-10.2-1.6-15.2s6.6-8.6 11.9-9.6L121 121 140.9 13.1c1-5.3 4.6-9.8 9.6-11.9s10.7-1.5 15.2 1.6L256 65.1 346.3 2.8c4.5-3.1 10.2-3.7 15.2-1.6zM160 256a96 96 0 1 1 192 0 96 96 0 1 1 -192 0zm224 0a128 128 0 1 0 -256 0 128 128 0 1 0 256 0z"></path></svg>
            </button>
            <button id="btn-search" aria-label="search-button">
                <svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 512 512"><path d="M416 208c0 45.9-14.9 88.3-40 122.7L502.6 457.4c12.5 12.5 12.5 32.8 0 45.3s-32.8 12.5-45.3 0L330.7 376c-34.4 25.2-76.8 40-122.7 40C93.1 416 0 322.9 0 208S93.1 0 208 0S416 93.1 416 208zM208 352a144 144 0 1 0 0-288 144 144 0 1 0 0 288z"></path></svg>
            </button>
            <button id="btn-nav" aria-pressed="false" aria-label="menu-button">
                <svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 448 512"><path d="M0 96C0 78.3 14.3 64 32 64H416c17.7 0 32 14.3 32 32s-14.3 32-32 32H32C14.3 128 0 113.7 0 96zM0 256c0-17.7 14.3-32 32-32H416c17.7 0 32 14.3 32 32s-14.3 32-32 32H32c-17.7 0-32-14.3-32-32zM448 416c0 17.7-14.3 32-32 32H32c-17.7 0-32-14.3-32-32s14.3-32 32-32H416c17.7 0 32 14.3 32 32z"></path></svg>
            </button>
        </h1>
        <a href="/" class="site-avatar" aria-label="site-avatar">
            <img src="/assets/img/profile.jpg" loading="lazy" alt="homepage" aria-label="homepage-button">
        </a>
    </div>
    <div class="side-info">
        <nav id="navigation">
    
    
    

    

        
    

        
    

        
    

        
    

        
    

        
    

        
    

        
    

        
    

        
    
            
            
            
            
            
            
            
            
            
            
            

    
    
    

    <ul class="nav-list">
<li id="nav-first" aria-label="Architecture">
            <div class="nav-item">
                <a href="/Architecture/" class="nav-list-link nav-lh">
                    <svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 448 512"><path d="M181.3 32.4c17.4 2.9 29.2 19.4 26.3 36.8L197.8 128h95.1l11.5-69.3c2.9-17.4 19.4-29.2 36.8-26.3s29.2 19.4 26.3 36.8L357.8 128H416c17.7 0 32 14.3 32 32s-14.3 32-32 32H347.1L325.8 320H384c17.7 0 32 14.3 32 32s-14.3 32-32 32H315.1l-11.5 69.3c-2.9 17.4-19.4 29.2-36.8 26.3s-29.2-19.4-26.3-36.8l9.8-58.7H155.1l-11.5 69.3c-2.9 17.4-19.4 29.2-36.8 26.3s-29.2-19.4-26.3-36.8L90.2 384H32c-17.7 0-32-14.3-32-32s14.3-32 32-32h68.9l21.3-128H64c-17.7 0-32-14.3-32-32s14.3-32 32-32h68.9l11.5-69.3c2.9-17.4 19.4-29.2 36.8-26.3zM187.1 192L165.8 320h95.1l21.3-128H187.1z"></path></svg>
                    <span>Architecture</span>
                </a><button class="nav-list-expander" aria-label="toggle items in Architecture category" aria-pressed="false">
                    <svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 448 512"><path d="M201.4 342.6c12.5 12.5 32.8 12.5 45.3 0l160-160c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0L224 274.7 86.6 137.4c-12.5-12.5-32.8-12.5-45.3 0s-12.5 32.8 0 45.3l160 160z"></path></svg>
                </button>
</div>
<ul class="nav-list">
<li id="nav-second" aria-label="api-design">
                    <div class="nav-item">
                        <a href="/Architecture/api-design/" class="nav-list-link nav-sh">
                            <svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 448 512"><path d="M432 256c0 17.7-14.3 32-32 32L48 288c-17.7 0-32-14.3-32-32s14.3-32 32-32l352 0c17.7 0 32 14.3 32 32z"></path></svg>
                            <span>api-design</span>
                        </a>
</div>
</li>
<li id="nav-second" aria-label="data-modeling-erd">
                    <div class="nav-item">
                        <a href="/Architecture/data-modeling-erd/" class="nav-list-link nav-sh">
                            <svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 448 512"><path d="M432 256c0 17.7-14.3 32-32 32L48 288c-17.7 0-32-14.3-32-32s14.3-32 32-32l352 0c17.7 0 32 14.3 32 32z"></path></svg>
                            <span>data-modeling-erd</span>
                        </a>
</div>
</li>
<li id="nav-second" aria-label="security-auth">
                    <div class="nav-item">
                        <a href="/Architecture/security-auth/" class="nav-list-link nav-sh">
                            <svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 448 512"><path d="M432 256c0 17.7-14.3 32-32 32L48 288c-17.7 0-32-14.3-32-32s14.3-32 32-32l352 0c17.7 0 32 14.3 32 32z"></path></svg>
                            <span>security-auth</span>
                        </a>
</div>
</li>
<li id="nav-second" aria-label="system-design">
                    <div class="nav-item">
                        <a href="/Architecture/system-design/" class="nav-list-link nav-sh">
                            <svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 448 512"><path d="M432 256c0 17.7-14.3 32-32 32L48 288c-17.7 0-32-14.3-32-32s14.3-32 32-32l352 0c17.7 0 32 14.3 32 32z"></path></svg>
                            <span>system-design</span>
                        </a>
</div>
</li>
</ul>
</li>
<li id="nav-first" aria-label="Java">
            <div class="nav-item">
                <a href="/Java/" class="nav-list-link nav-lh">
                    <svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 448 512"><path d="M181.3 32.4c17.4 2.9 29.2 19.4 26.3 36.8L197.8 128h95.1l11.5-69.3c2.9-17.4 19.4-29.2 36.8-26.3s29.2 19.4 26.3 36.8L357.8 128H416c17.7 0 32 14.3 32 32s-14.3 32-32 32H347.1L325.8 320H384c17.7 0 32 14.3 32 32s-14.3 32-32 32H315.1l-11.5 69.3c-2.9 17.4-19.4 29.2-36.8 26.3s-29.2-19.4-26.3-36.8l9.8-58.7H155.1l-11.5 69.3c-2.9 17.4-19.4 29.2-36.8 26.3s-29.2-19.4-26.3-36.8L90.2 384H32c-17.7 0-32-14.3-32-32s14.3-32 32-32h68.9l21.3-128H64c-17.7 0-32-14.3-32-32s14.3-32 32-32h68.9l11.5-69.3c2.9-17.4 19.4-29.2 36.8-26.3zM187.1 192L165.8 320h95.1l21.3-128H187.1z"></path></svg>
                    <span>Java</span>
                </a>
</div>
</li>
<li id="nav-first" aria-label="Spring Boot">
            <div class="nav-item">
                <a href="/Spring%20Boot/" class="nav-list-link nav-lh">
                    <svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 448 512"><path d="M181.3 32.4c17.4 2.9 29.2 19.4 26.3 36.8L197.8 128h95.1l11.5-69.3c2.9-17.4 19.4-29.2 36.8-26.3s29.2 19.4 26.3 36.8L357.8 128H416c17.7 0 32 14.3 32 32s-14.3 32-32 32H347.1L325.8 320H384c17.7 0 32 14.3 32 32s-14.3 32-32 32H315.1l-11.5 69.3c-2.9 17.4-19.4 29.2-36.8 26.3s-29.2-19.4-26.3-36.8l9.8-58.7H155.1l-11.5 69.3c-2.9 17.4-19.4 29.2-36.8 26.3s-29.2-19.4-26.3-36.8L90.2 384H32c-17.7 0-32-14.3-32-32s14.3-32 32-32h68.9l21.3-128H64c-17.7 0-32-14.3-32-32s14.3-32 32-32h68.9l11.5-69.3c2.9-17.4 19.4-29.2 36.8-26.3zM187.1 192L165.8 320h95.1l21.3-128H187.1z"></path></svg>
                    <span>Spring Boot</span>
                </a><button class="nav-list-expander" aria-label="toggle items in Spring Boot category" aria-pressed="false">
                    <svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 448 512"><path d="M201.4 342.6c12.5 12.5 32.8 12.5 45.3 0l160-160c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0L224 274.7 86.6 137.4c-12.5-12.5-32.8-12.5-45.3 0s-12.5 32.8 0 45.3l160 160z"></path></svg>
                </button>
</div>
<ul class="nav-list"><li id="nav-second" aria-label="Security">
                    <div class="nav-item">
                        <a href="/Spring%20Boot/Security/" class="nav-list-link nav-sh">
                            <svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 448 512"><path d="M432 256c0 17.7-14.3 32-32 32L48 288c-17.7 0-32-14.3-32-32s14.3-32 32-32l352 0c17.7 0 32 14.3 32 32z"></path></svg>
                            <span>Security</span>
                        </a>
</div>
</li></ul>
</li>
<li id="nav-first" aria-label="Trouble Shooting">
            <div class="nav-item">
                <a href="/Trouble%20Shooting/" class="nav-list-link nav-lh">
                    <svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 448 512"><path d="M181.3 32.4c17.4 2.9 29.2 19.4 26.3 36.8L197.8 128h95.1l11.5-69.3c2.9-17.4 19.4-29.2 36.8-26.3s29.2 19.4 26.3 36.8L357.8 128H416c17.7 0 32 14.3 32 32s-14.3 32-32 32H347.1L325.8 320H384c17.7 0 32 14.3 32 32s-14.3 32-32 32H315.1l-11.5 69.3c-2.9 17.4-19.4 29.2-36.8 26.3s-29.2-19.4-26.3-36.8l9.8-58.7H155.1l-11.5 69.3c-2.9 17.4-19.4 29.2-36.8 26.3s-29.2-19.4-26.3-36.8L90.2 384H32c-17.7 0-32-14.3-32-32s14.3-32 32-32h68.9l21.3-128H64c-17.7 0-32-14.3-32-32s14.3-32 32-32h68.9l11.5-69.3c2.9-17.4 19.4-29.2 36.8-26.3zM187.1 192L165.8 320h95.1l21.3-128H187.1z"></path></svg>
                    <span>Trouble Shooting</span>
                </a>
</div>
</li>
<li id="nav-first" aria-label="Home">
            <div class="nav-item">
                <a href="/" class="nav-list-link nav-lh">
                    <svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 448 512"><path d="M181.3 32.4c17.4 2.9 29.2 19.4 26.3 36.8L197.8 128h95.1l11.5-69.3c2.9-17.4 19.4-29.2 36.8-26.3s29.2 19.4 26.3 36.8L357.8 128H416c17.7 0 32 14.3 32 32s-14.3 32-32 32H347.1L325.8 320H384c17.7 0 32 14.3 32 32s-14.3 32-32 32H315.1l-11.5 69.3c-2.9 17.4-19.4 29.2-36.8 26.3s-29.2-19.4-26.3-36.8l9.8-58.7H155.1l-11.5 69.3c-2.9 17.4-19.4 29.2-36.8 26.3s-29.2-19.4-26.3-36.8L90.2 384H32c-17.7 0-32-14.3-32-32s14.3-32 32-32h68.9l21.3-128H64c-17.7 0-32-14.3-32-32s14.3-32 32-32h68.9l11.5-69.3c2.9-17.4 19.4-29.2 36.8-26.3zM187.1 192L165.8 320h95.1l21.3-128H187.1z"></path></svg>
                    <span>Home</span>
                </a>
</div>
</li>
</ul>
</nav>
        <div id="contact">
            <hr>
            <h3>Contact</h3>
            <ul class="contact-list">
                
                    <li><a aria-label="My Github" href="https://github.com/Gimini-3">
                        <svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 496 512"><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3 .3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5 .3-6.2 2.3zm44.2-1.7c-2.9 .7-4.9 2.6-4.6 4.9 .3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3 .7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3 .3 2.9 2.3 3.9 1.6 1 3.6 .7 4.3-.7 .7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3 .7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3 .7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"></path></svg>
                    </a></li>
                
                
                    <li><a aria-label="My Email" href="mailto:gimin1463@naver.com">
                        <svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 512 512"><path d="M48 64C21.5 64 0 85.5 0 112c0 15.1 7.1 29.3 19.2 38.4L236.8 313.6c11.4 8.5 27 8.5 38.4 0L492.8 150.4c12.1-9.1 19.2-23.3 19.2-38.4c0-26.5-21.5-48-48-48H48zM0 176V384c0 35.3 28.7 64 64 64H448c35.3 0 64-28.7 64-64V176L294.4 339.2c-22.8 17.1-54 17.1-76.8 0L0 176z"></path></svg>
                    </a></li>
                
                
                
                    <li><a aria-label="My Instagram" href="https://www.instagram.com/gimin0226">
                        <svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 448 512"><path d="M224.1 141c-63.6 0-114.9 51.3-114.9 114.9s51.3 114.9 114.9 114.9S339 319.5 339 255.9 287.7 141 224.1 141zm0 189.6c-41.1 0-74.7-33.5-74.7-74.7s33.5-74.7 74.7-74.7 74.7 33.5 74.7 74.7-33.6 74.7-74.7 74.7zm146.4-194.3c0 14.9-12 26.8-26.8 26.8-14.9 0-26.8-12-26.8-26.8s12-26.8 26.8-26.8 26.8 12 26.8 26.8zm76.1 27.2c-1.7-35.9-9.9-67.7-36.2-93.9-26.2-26.2-58-34.4-93.9-36.2-37-2.1-147.9-2.1-184.9 0-35.8 1.7-67.6 9.9-93.9 36.1s-34.4 58-36.2 93.9c-2.1 37-2.1 147.9 0 184.9 1.7 35.9 9.9 67.7 36.2 93.9s58 34.4 93.9 36.2c37 2.1 147.9 2.1 184.9 0 35.9-1.7 67.7-9.9 93.9-36.2 26.2-26.2 34.4-58 36.2-93.9 2.1-37 2.1-147.8 0-184.8zM398.8 388c-7.8 19.6-22.9 34.7-42.6 42.6-29.5 11.7-99.5 9-132.1 9s-102.7 2.6-132.1-9c-19.6-7.8-34.7-22.9-42.6-42.6-11.7-29.5-9-99.5-9-132.1s-2.6-102.7 9-132.1c7.8-19.6 22.9-34.7 42.6-42.6 29.5-11.7 99.5-9 132.1-9s102.7-2.6 132.1 9c19.6 7.8 34.7 22.9 42.6 42.6 11.7 29.5 9 99.5 9 132.1s2.7 102.7-9 132.1z"></path></svg>
                    </a></li>
                
                
                
                    <li><a aria-label="My LinkedIn" href="https://www.linkedin.com/in/g-m-627b33392">
                        <svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 448 512"><path d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9V416z"></path></svg>
                    </a></li>
                
            </ul>
            <hr>
            <span>
                Copyright © 2024 | <a href="https://github.com/byanko55/jekyll-theme-satellite">Yankos</a>
            </span>
        </div>
    </div>
</div>
<div class="sidebar sidebar-right">
    <div class="tools">
        <button id="btn-brightness" aria-label="brightness-button">
            <svg class="ico-dark" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 384 512"><path d="M223.5 32C100 32 0 132.3 0 256S100 480 223.5 480c60.6 0 115.5-24.2 155.8-63.4c5-4.9 6.3-12.5 3.1-18.7s-10.1-9.7-17-8.5c-9.8 1.7-19.8 2.6-30.1 2.6c-96.9 0-175.5-78.8-175.5-176c0-65.8 36-123.1 89.3-153.3c6.1-3.5 9.2-10.5 7.7-17.3s-7.3-11.9-14.3-12.5c-6.3-.5-12.6-.8-19-.8z"></path></svg>
            <svg class="ico-light" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 512 512"><path d="M361.5 1.2c5 2.1 8.6 6.6 9.6 11.9L391 121l107.9 19.8c5.3 1 9.8 4.6 11.9 9.6s1.5 10.7-1.6 15.2L446.9 256l62.3 90.3c3.1 4.5 3.7 10.2 1.6 15.2s-6.6 8.6-11.9 9.6L391 391 371.1 498.9c-1 5.3-4.6 9.8-9.6 11.9s-10.7 1.5-15.2-1.6L256 446.9l-90.3 62.3c-4.5 3.1-10.2 3.7-15.2 1.6s-8.6-6.6-9.6-11.9L121 391 13.1 371.1c-5.3-1-9.8-4.6-11.9-9.6s-1.5-10.7 1.6-15.2L65.1 256 2.8 165.7c-3.1-4.5-3.7-10.2-1.6-15.2s6.6-8.6 11.9-9.6L121 121 140.9 13.1c1-5.3 4.6-9.8 9.6-11.9s10.7-1.5 15.2 1.6L256 65.1 346.3 2.8c4.5-3.1 10.2-3.7 15.2-1.6zM160 256a96 96 0 1 1 192 0 96 96 0 1 1 -192 0zm224 0a128 128 0 1 0 -256 0 128 128 0 1 0 256 0z"></path></svg>
        </button>
        <button id="btn-search" aria-label="search-button">
            <svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 512 512"><path d="M416 208c0 45.9-14.9 88.3-40 122.7L502.6 457.4c12.5 12.5 12.5 32.8 0 45.3s-32.8 12.5-45.3 0L330.7 376c-34.4 25.2-76.8 40-122.7 40C93.1 416 0 322.9 0 208S93.1 0 208 0S416 93.1 416 208zM208 352a144 144 0 1 0 0-288 144 144 0 1 0 0 288z"></path></svg>
        </button>
    </div>
<div class="toc">
        <span class="toc-header">
            <svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 384 512"><path d="M0 48V487.7C0 501.1 10.9 512 24.3 512c5 0 9.9-1.5 14-4.4L192 400 345.7 507.6c4.1 2.9 9 4.4 14 4.4c13.4 0 24.3-10.9 24.3-24.3V48c0-26.5-21.5-48-48-48H48C21.5 0 0 21.5 0 48z"></path></svg>
            Contents
        </span>
        <div class="toc-board"></div>
    </div>
</div>
        <div id="post">
            <div class="inner-header">
                <span class="dot" style="background-color: #F86158;"></span>
                <span class="dot" style="background-color: #FBBF2D;"></span>
                <span class="dot" style="background-color: #2ACB45;"></span>
            </div>
            <div class="inner-content">
                <div class="category-tree">
<svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 576 512"><path d="M575.8 255.5c0 18-15 32.1-32 32.1h-32l.7 160.2c0 2.7-.2 5.4-.5 8.1V472c0 22.1-17.9 40-40 40H456c-1.1 0-2.2 0-3.3-.1c-1.4 .1-2.8 .1-4.2 .1H416 392c-22.1 0-40-17.9-40-40V448 384c0-17.7-14.3-32-32-32H256c-17.7 0-32 14.3-32 32v64 24c0 22.1-17.9 40-40 40H160 128.1c-1.5 0-3-.1-4.5-.2c-1.2 .1-2.4 .2-3.6 .2H104c-22.1 0-40-17.9-40-40V360c0-.9 0-1.9 .1-2.8V287.6H32c-18 0-32-14-32-32.1c0-9 3-17 10-24L266.4 8c7-7 15-8 22-8s15 2 21 7L564.8 231.5c8 7 12 15 11 24z"></path></svg>
    <p>
                <a href="/">Home</a>
                &gt;
            <a href="/Architecture/">Architecture</a>
                &gt;
            <a href="/Architecture/system-design/">system-design</a>
                &gt;
            
                
                    [시스템 설계] 하루 한 번 알림을 “누락 없이” 보내기 위한 Redis 큐 &amp; 워커 설계
                
            </p>
</div>
                
                    <div class="post-header">
    <div class="thumbnail">
        <div class="transbox">
            
                <span class="post-title">[시스템 설계] 하루 한 번 알림을 “누락 없이” 보내기 위한 Redis 큐 &amp; 워커 설계</span>
            
            <div class="post-info">
                
                    <a class="info-box category-box" href="/Architecture">
                        <svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 576 512"><path d="M384 480h48c11.4 0 21.9-6 27.6-15.9l112-192c5.8-9.9 5.8-22.1 .1-32.1S555.5 224 544 224H144c-11.4 0-21.9 6-27.6 15.9L48 357.1V96c0-8.8 7.2-16 16-16H181.5c4.2 0 8.3 1.7 11.3 4.7l26.5 26.5c21 21 49.5 32.8 79.2 32.8H416c8.8 0 16 7.2 16 16v32h48V160c0-35.3-28.7-64-64-64H298.5c-17 0-33.3-6.7-45.3-18.7L226.7 50.7c-12-12-28.3-18.7-45.3-18.7H64C28.7 32 0 60.7 0 96V416c0 35.3 28.7 64 64 64H87.7 384z"></path></svg>
                        <span>Architecture</span>
                    </a>
                
                <span class="info-box">
                    <svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 448 512"><path d="M152 24c0-13.3-10.7-24-24-24s-24 10.7-24 24V64H64C28.7 64 0 92.7 0 128v16 48V448c0 35.3 28.7 64 64 64H384c35.3 0 64-28.7 64-64V192 144 128c0-35.3-28.7-64-64-64H344V24c0-13.3-10.7-24-24-24s-24 10.7-24 24V64H152V24zM48 192h80v56H48V192zm0 104h80v64H48V296zm128 0h96v64H176V296zm144 0h80v64H320V296zm80-48H320V192h80v56zm0 160v40c0 8.8-7.2 16-16 16H320V408h80zm-128 0v56H176V408h96zm-144 0v56H64c-8.8 0-16-7.2-16-16V408h80zM272 248H176V192h96v56z"></path></svg>
                    <span>
                            2025-11-03
                        
                    </span>
                </span>
                
                <a class="info-box" id="comments-counter">
                    <svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 512 512"><path d="M512 240c0 114.9-114.6 208-256 208c-37.1 0-72.3-6.4-104.1-17.9c-11.9 8.7-31.3 20.6-54.3 30.6C73.6 471.1 44.7 480 16 480c-6.5 0-12.3-3.9-14.8-9.9c-2.5-6-1.1-12.8 3.4-17.4l0 0 0 0 0 0 0 0 .3-.3c.3-.3 .7-.7 1.3-1.4c1.1-1.2 2.8-3.1 4.9-5.7c4.1-5 9.6-12.4 15.2-21.6c10-16.6 19.5-38.4 21.4-62.9C17.7 326.8 0 285.1 0 240C0 125.1 114.6 32 256 32s256 93.1 256 208z"></path></svg>
                    <span id="num-comments">-</span>
                </a>
            </div>
        </div>
    </div>
</div>
<div class="tag-box">
<span class="tag theme-0" contentid="redis">
            redis
        </span><span class="tag theme-1" contentid="worker">
            worker
        </span><span class="tag theme-2" contentid="at-least-once-notification">
            at-least-once-notification
        </span><span class="tag theme-0" contentid="spring schedule">
            spring schedule
        </span><span class="tag theme-1" contentid="blmove">
            blmove
        </span><span class="tag theme-2" contentid="redis-queue-blmove-idempotency">
            redis-queue-blmove-idempotency
        </span>
</div>
<main>
    <h1 id="시스템-설계-하루-한-번-알림을-누락-없이-보내기-위한-redis-큐--워커-설계">[시스템 설계] 하루 한 번 알림을 “누락 없이” 보내기 위한 Redis 큐 &amp; 워커 설계</h1>

<h2 id="1-시스템-목표"><strong>1. 시스템 목표</strong></h2>

<ul>
  <li>“하루에 한 번”과 같이 정해진 알림을 <strong>누락 없이</strong> 전송한다. (At-least-once Delivery)</li>
  <li>API 서버 장애, DB 장애, 애플리케이션 장애 등 어떤 상황에서도 작업 유실을 방지한다.</li>
  <li>장애 복구 시 발생할 수 있는 <strong>중복 발송</strong>을 최소화하고, 제어(멱등성)할 수 있도록 설계한다.</li>
</ul>

<h2 id="2-아키텍처-설계">2. 아키텍처 설계</h2>

<p><img src="../../../assets/img/at-least-once-notification-redis-queue-blmove-idempotency.png" alt="at-least-once-notification-redis-queue-blmove-idempotency.png" loading="lazy"></p>

<p>[1단계: 생산자 (Scheduler) 영역]</p>

<ol>
  <li>별도의 스케줄러 스레드가 알림 발송 시간 10분 전에 User 테이블에서 알람 설정 한 유저 정보를 조회한다.</li>
  <li>유저 정보를 조회한 스케줄러는 오늘 알림 설정을 on 한 사용자들에 대해서만 quiz_notification_log 테이블을 생성하고 저장한다. (초기 status=’PENDING’)</li>
  <li>발송 시간이 되면 메인 스케줄러 스레드는 quiz_notification_log 테이블에서 오늘 작업들을 조회한다.</li>
  <li>quiz_notification_log 테이블의 <strong>status</strong>를 ‘PENDING’에서 ‘QUEUED’로 변경한다.
    <ul>
      <li>트랜잭션 처리 함으로써 전부 QUEUED로 변경되도록 한다.</li>
    </ul>
  </li>
  <li>트랜잭션으로 상태 변경(‘QUEUED’)된 작업들을 레디스 큐(main-queue)에 푸시한다.
    <ul>
      <li>푸시 중간에 서버가 다운되면 보조 스케줄러가 돌면서 status=’QUEUED’인데 10분이 지나도록 SENT로 바뀌지 않은 작업들을 찾아서 다시 큐에 푸시한다. (작업 유실 방지)
        <ul>
          <li>updated_at/ created_at 기반으로 판단한다.</li>
        </ul>
      </li>
    </ul>
  </li>
</ol>

<p>[2단계: 소비자 (Worker) 영역]</p>

<ol>
  <li>main-queue에서 worker-N-processing-queue(워커 전용 백업 큐)로 <strong>BLMOVE</strong>를 통해 원자적 이동을 실행한다.
    <ul>
      <li>processing-queue에서는 작업의 모든 과정이 완료되어야만 해당 작업을 삭제한다.</li>
    </ul>
  </li>
  <li>워커 스레드가 자신의 processing-queue에서 작업을 가져온다.
    <ul>
      <li>processing-queue에서 작업을 가져오는 것은 <strong>읽기(LRANGE 등)</strong>로 처리한다.</li>
      <li>삭제는 작업의 모든 과정이 완료된 후 마지막에 수행된다.</li>
    </ul>
  </li>
  <li>quiz_notification_log 테이블의 <strong>status</strong>를 ‘QUEUED’에서 ‘PROCESSING’으로 변경한다.
    <ul>
      <li>(의미: 작업이 큐에서 꺼내져 처리가 시작되었음을 보장. API 호출 성공 여부는 보장 X)</li>
    </ul>
  </li>
  <li>사용자에게 알람을 보내는 API를 호출한다.</li>
  <li>API 응답 결과에 따라 작업을 분기 처리한다.
    <ul>
      <li>성공 시: quiz_notification_log 테이블의 <strong>status</strong>를 ‘PROCESSING’에서 ‘SENT’로 변경한다. (→ 11단계로 이동)</li>
      <li>일시적 실패 시 (5xx 등): retry-queue로 (원자적 이동을 통해) 옮겨지며, retry 전문 워커 스레드에 의해서 재시도 된다.</li>
      <li>영구적 실패 시 (4xx 등): dlq-queue로 (원자적 이동을 통해) 옮겨진다. 개발자가 수동으로 원인 분석 및 버그 수정을 해야 한다.</li>
    </ul>
  </li>
  <li>최종 처리 후 processing-queue에서 작업을 삭제한다.
    <ul>
      <li>DB <strong>status</strong>가 ‘SENT’로 상태 변경된 것을 확인한 후, <strong>LREM</strong>으로 processing-queue에서 해당 작업을 제거한다.</li>
    </ul>
  </li>
</ol>

<h2 id="3-실패-지점">3. 실패 지점</h2>

<h3 id="생산자scheduler-영역">[생산자(Scheduler) 영역]</h3>

<ol>
  <li>DB 조회 실패
    <ul>
      <li>문제: DB 장애로 유저 목록 조회가 실패한다.</li>
      <li>결과: 스케줄러가 아예 시작을 못 한다.</li>
    </ul>
  </li>
  <li>큐 등록 실패
    <ul>
      <li>문제: 큐 등록을 하다가 중간에 스케줄러가 다운된다.</li>
    </ul>
  </li>
</ol>

<h3 id="소비자worker-영역">[소비자(Worker) 영역]</h3>

<ol>
  <li>큐 작업 확보 문제
    <ul>
      <li>문제: <code class="language-plaintext highlighter-rouge">BRPOP</code>을  썼을 때, 워커가 작업을 꺼내고 처리(API 호출)하기 직전에 다운된다.</li>
      <li>해결책: <code class="language-plaintext highlighter-rouge">BLMOVE</code>를 사용해 작업을 <code class="language-plaintext highlighter-rouge">processing-queue</code>로 안전하게 이동시킨다.</li>
    </ul>
  </li>
  <li>API 호출 실패
    <ul>
      <li>문제: 카카오 서버가 에러를 반환하거나 네트워크가 불안정하다.</li>
      <li>해결책: <code class="language-plaintext highlighter-rouge">retry-queue</code> 로 작업을 보내 재시도한다. (최종 실패 시 <code class="language-plaintext highlighter-rouge">dlq-queue</code>로 격리)</li>
    </ul>
  </li>
</ol>

<h3 id="워커가-api-성공-이후에-실패하는-영역">[워커가 API 성공 ‘이후’에 실패하는 영역]</h3>

<ol>
  <li>DB 로그 기록 실패
    <ul>
      <li>문제: API 호출은 성공했는데 , <code class="language-plaintext highlighter-rouge">quiz_notification_log</code> 테이블에 <code class="language-plaintext highlighter-rouge">SENT</code>라고 <code class="language-plaintext highlighter-rouge">UPDATE</code> 하려는 순간 DB 장애 발생→ 퀴즈는 발송됐지만, DB엔 기록이 안 됐다.</li>
    </ul>
  </li>
  <li>작업 완료 처리 실패
    <ul>
      <li>문제: API 호출도 성공하고, DB 로그 기록도 성공했다. 이제 <code class="language-plaintext highlighter-rouge">processing-queue</code> 에서 작업을 <code class="language-plaintext highlighter-rouge">LREM</code> (삭제) 하려던 순간 Redis가 다운된다.</li>
    </ul>
  </li>
</ol>

<hr>

<h2 id="큐-등록-실패-문제-해결-방안">큐 등록 실패 문제 해결 방안</h2>

<h3 id="1-사전에-발송-대상을-확정-log-테이블-생성">1. 사전에 발송 대상을 확정 (log 테이블 생성)</h3>

<p>스케줄러가 정해진 발송 시간에 User 테이블을 읽는 것이 아니라, 그 이전에 ‘오늘 보낼 작업 목록’을 quiz_notification_log 테이블에 미리 생성해 둔다.</p>

<ul>
  <li>테이블 : quiz_notification_log</li>
  <li>컬럼: id(PK), user_id(FK), quiz_data, status (PENDING, QUEUED, PROCESSING, SENT, FAILED)</li>
  <li>시간 : 퀴즈 발송 10분 전</li>
  <li>동작: 별도의 스케줄러가 User 테이블을 읽어, 오늘 퀴즈를 받아야 할 목록을 quiz_notification_log에 INSERT 한다. (초기 상태 ‘PENDING’)</li>
  <li>결과: quiz_notification_log 테이블에 오늘 처리해야 할 작업이 status = ‘PENDING’ 상태로 모두 저장된다.</li>
</ul>

<h3 id="2-작업-등록-스케줄러">2. 작업 등록 스케줄러</h3>

<p>정해진 발송 시간이 되면 메인 스케줄러(Producer)가 동작한다.</p>

<p>이 스케줄러는 <code class="language-plaintext highlighter-rouge">User</code> 테이블을 보는 것이 아니라, <code class="language-plaintext highlighter-rouge">quiz_notification_log</code> 테이블만 본다.</p>

<p>(만약 사용자가 많으면 한 번에 처리하지 않고, 나눠서 배치로 처리한다)</p>

<h3 id="3-트랜잭션-관리--실패-시-복구">3. 트랜잭션 관리 &amp; 실패 시 복구</h3>

<p>A. DB 트랜잭션</p>

<ol>
  <li>@Transactional이 시작된다.</li>
  <li>
<code class="language-plaintext highlighter-rouge">PENDING</code>인 작업을 찾아서(배치면 배치 개수만큼), 다른 스케줄러가 접근하지 못하도록 DB 락을 건다.
    <ul>
      <li>User 테이블이 아닌 quiz_notification_log 테이블 락이여서 락 경합이 발생하지 않는다.</li>
    </ul>
  </li>
  <li>락을 건 작업들의 status를 <code class="language-plaintext highlighter-rouge">QUEUED</code> 로 변경한다.</li>
  <li>트랜잭션이 COMMIT 된다.
    <ul>
      <li>만약 1~4번 사이에서 서버가 다운되면?</li>
    </ul>
    <ul>
      <li>DB 트랜잭션이 롤백된다.</li>
      <li>status는 다시 <code class="language-plaintext highlighter-rouge">PENDING</code> 상태로 돌아가고 락도 풀린다.</li>
      <li>Redis에는 아무것도 들어가지 않는다.</li>
      <li>결과: 스케줄러가 재시작되면 이 <code class="language-plaintext highlighter-rouge">PENDING</code> 작업 1000개를 다시 처리한다.
        <ul>
          <li>
<code class="language-plaintext highlighter-rouge">@Scheduled(fixedRate = 60000)</code> 으로 스레드 풀에 있는 태스크 스케줄러에게 작업을 할당한 후, while 문에서 <code class="language-plaintext highlighter-rouge">PENDING</code> 상태인 작업이 없을 때까지 루프를 돌게 한다.</li>
          <li>예를 들어 서버가 다운되더라도 서버가 재시작한다면 스케줄러가 다시 돌며 실패한 작업들을 <code class="language-plaintext highlighter-rouge">PENDING</code> 상태가 없을 때까지 작업을 처리한다.</li>
        </ul>
      </li>
    </ul>
  </li>
</ol>

<p>B. Redis 등록 ( DB 커밋 이후)</p>

<ol>
  <li>A번의 DB 트랜잭션이 성공적으로 COMMIT 되었다 (DB는 <code class="language-plaintext highlighter-rouge">QUEUED</code> 상태)</li>
  <li>이제 for 문을 돌며 Redis에 1000개의 작업을 <code class="language-plaintext highlighter-rouge">LPUSH</code> 한다.
    <ul>
      <li>만약 <code class="language-plaintext highlighter-rouge">LPUSH</code> 중간에 서버가 다운되면?</li>
    </ul>
    <ul>
      <li>DB 상태: 1000개 모두 <code class="language-plaintext highlighter-rouge">QUEUED</code> 이다.</li>
      <li>Redis 상태: 600개만 큐에 들어갔다.</li>
      <li>문제: 400개는 <code class="language-plaintext highlighter-rouge">QUEUED</code> 상태로 DB에 저장된다(REDIS에는 없음)</li>
      <li>해결책: 보조 스케줄러가 2분마다 돌면서, quiz_notification_log에 <code class="language-plaintext highlighter-rouge">status = 'QUEUED'</code> 인데 10분이 지나도록 <code class="language-plaintext highlighter-rouge">SENT</code> 로 바뀌지 않은 작업들을 찾는다.</li>
      <li>나머지 400개의 작업을 다시 Redis 큐에 LPUSH 해준다.</li>
      <li>결과: 작업 유실이 복구된다. (최소 1회 보장)</li>
    </ul>
  </li>
</ol>

<hr>

<h2 id="큐-작업-확보-문제">큐 작업 확보 문제</h2>

<h3 id="1-문제-상황">1. 문제 상황</h3>

<p><code class="language-plaintext highlighter-rouge">BRPOP(Blocking Right Pop)</code>은 큐에서 데이터를 꺼내오는 순간 그 데이터는 큐에서 영구적으로 삭제된다.</p>

<p>그래서 워커가 Redis에서 작업을 꺼내와도 워커 서버가 다운되면 작업이 유실된다.</p>

<h3 id="2-blmove-원자적-이동-후-데이터-반환">2. BLMOVE (원자적 이동 후 데이터 반환)</h3>

<p>두 가지 일을 단 하나의 원자적(Atomic) 명령으로 묶어버린다.</p>

<ul>
  <li>일 1: <code class="language-plaintext highlighter-rouge">main-queue</code>에서 데이터를 꺼낸다. (Pop)→ <code class="language-plaintext highlighter-rouge">processing-queue</code>에 데이터를 밀어 넣는다. (Push)</li>
  <li>일 2: 성공한 데이터를, 명령을 요청했던 워커에게 응답으로 즉시 반환한다.</li>
</ul>

<p>즉 둘 다 성공하거나 둘 다 실패하는 것을 Redis 서버가 보장한다.</p>

<h3 id="동작-순서">동작 순서</h3>

<ol>
  <li>워커
    <ul>
      <li>
<code class="language-plaintext highlighter-rouge">BRPOP</code> 대신 <code class="language-plaintext highlighter-rouge">BLMOVE</code> 명령을 실행한다.</li>
      <li><code class="language-plaintext highlighter-rouge">BLMOVE main-queue worker-1-processing-queue RIGHT LEFT 0</code></li>
    </ul>
    <ul>
      <li>설명: RIGHT에서 꺼내서(큐 뒤) LEFT로 넣기(큐 앞)</li>
      <li>0의 의미: <code class="language-plaintext highlighter-rouge">main-queue</code>에 작업이 들어올 때까지 영원히 대기한다.</li>
      <li>worker 스레드마다 개별 <code class="language-plaintext highlighter-rouge">processing-queue</code>를 둔다</li>
      <li>공용으로 두면 갇힌 작업을 누가 어떻게 복구할지 매우 복잡해진다. (A 워커가 특정 작업을 처리중인지 실패했는지 모르기 때문)</li>
    </ul>
  </li>
  <li>Redis
    <ul>
      <li>
<code class="language-plaintext highlighter-rouge">task-123</code>을 <code class="language-plaintext highlighter-rouge">main-queue</code>에서 삭제함과 동시에 <code class="language-plaintext highlighter-rouge">worker-1-processing-queue</code>에 추가한다.(원자적)</li>
      <li>모든 이동이 완료된 후, 워커에게 <code class="language-plaintext highlighter-rouge">task-123</code>을 반환한다.</li>
    </ul>
  </li>
  <li>워커
    <ul>
      <li>
<code class="language-plaintext highlighter-rouge">task-123</code>을 받고 이제 이 작업이 <code class="language-plaintext highlighter-rouge">worker-1-processing-queue</code>에 안전하게 백업된 것을 안다.</li>
      <li>이제 API 호출을 시작한다.</li>
    </ul>
  </li>
  <li>워커
    <ul>
      <li>성공 시</li>
    </ul>
    <ul>
      <li>
        <p>API 호출 직전에, DB상태를 <code class="language-plaintext highlighter-rouge">QUEUED</code>에서 <code class="language-plaintext highlighter-rouge">PROCESSING</code>으로 먼저 변경(UPDATE)한다.</p>

        <p>(만약 이 UPDATE가 실패하면(DB장애, 애플리케이션 서버 다운 등), API 호출은 일어나지 않았고 큐에도 작업이 남아있으므로 재시작시 100% 안전하다.)<br>
이 UPDATE가 성공한 작업에 대해서만 API 호출을 시작한다.</p>
      </li>
      <li>API 호출이 성공하고, DB 로그(<code class="language-plaintext highlighter-rouge">PROCESSING</code>-&gt; <code class="language-plaintext highlighter-rouge">SENT</code>) 기록도 성공한다.</li>
      <li>모든 처리가 완료되었으므로, 백업 큐에 있던 작업을 수동으로 삭제해야 한다.</li>
      <li><code class="language-plaintext highlighter-rouge">LREM worker-1-processing-queue 1 task-123</code></li>
      <li>(의미: <code class="language-plaintext highlighter-rouge">worker-1-processing-queue</code>에서 <code class="language-plaintext highlighter-rouge">task-123</code> 값 1개를 찾아서 <strong>삭제</strong>)<br>
    - 실패 시</li>
      <li>워커 애플리케이션 다운된 후 재시작한다.</li>
      <li>로직 1순위로 <code class="language-plaintext highlighter-rouge">worker-1-processing-queue</code>를 먼저 확인한다.</li>
      <li>
<code class="language-plaintext highlighter-rouge">worker-1-processing-queue</code>에 아까 다운될 때 처리 중이던 <code class="language-plaintext highlighter-rouge">task-123</code>이 그대로 남아있는 것을 발견한다.</li>
      <li>이 <code class="language-plaintext highlighter-rouge">task-123</code>  작업을 다시 처리(API 호출)하기 시작한다.</li>
    </ul>
  </li>
</ol>

<h3 id="주의사항">주의사항</h3>

<ol>
  <li>
    <p>다시 작업을 꺼낼때는 읽기로 꺼내기(삭제는 최종)</p>

    <p>만약 워커가 다운된 후 <code class="language-plaintext highlighter-rouge">processing-queue</code>에서 작업을 또다시 꺼내어 처리한다면 다시 워커가 다운된다면 데이터가 유실된다.</p>

    <p>→ 따라서 실패 후 재처리 로직은 삭제가 아닌 읽기이다.</p>

    <p>재시작된 워커 동작 원리</p>

    <ol>
      <li>작업 확인
        <ul>
          <li>
<code class="language-plaintext highlighter-rouge">processing-queue</code>에서 작업을 삭제하지 않고 읽기만 한다.</li>
          <li>명령어: <code class="language-plaintext highlighter-rouge">LRANGE worker-1-processing-queue 0 0</code>
</li>
          <li>(의미: <code class="language-plaintext highlighter-rouge">worker-1-processing-queue</code>의 첫 번째 작업을 삭제하지 말고, 보여줘)</li>
        </ul>
        <ul>
          <li>워커가 <code class="language-plaintext highlighter-rouge">main-queue</code>에서 작업을 확보할 때 단 1개의 작업만 <code class="language-plaintext highlighter-rouge">processing-queue</code>로 가져온다.
            <ul>
              <li>워커 하나는 동시에 하나의 작업만 처리한다.</li>
            </ul>
          </li>
          <li>api 호출 → DB 로그 변경 → 큐에서 데이터 삭제 이 과정이 끝나야 <code class="language-plaintext highlighter-rouge">processing-queue</code>에서 작업을 삭제한다.</li>
        </ul>
      </li>
      <li>작업 재처리
        <ul>
          <li>워커는 <code class="language-plaintext highlighter-rouge">task-123</code>이 큐에 안전하게 남아있는 상태여서, API 호출을 다시 시도한다.</li>
        </ul>
      </li>
      <li>만약 또 실패하면?
        <ul>
          <li>워커가 API 호출 중에 또 다운되어도, 1번 단계에서 작업을 삭제한 적이 없으므로 <code class="language-plaintext highlighter-rouge">task-123</code>은 <code class="language-plaintext highlighter-rouge">processing-queue</code>에 여전히 안전하게 남아있는다.</li>
        </ul>
      </li>
      <li>최종 성공 시
        <ul>
          <li>API 호출과 DB 기록이 모두 성공했을 때, 워커가 그제서야 <code class="language-plaintext highlighter-rouge">processing-queue</code>에서 작업 삭제한다.</li>
          <li>명령어: <code class="language-plaintext highlighter-rouge">LREM worker-1-processing-queue 1 task-123</code>
</li>
        </ul>
      </li>
    </ol>
  </li>
  <li>
    <p>워커 영구 장애 시 <code class="language-plaintext highlighter-rouge">processing-queue</code> 작업 정체</p>

    <p>현재는 <code class="language-plaintext highlighter-rouge">worker-1-processing-queue</code> 와 같이 워커별로 개별 큐를 두고 있다. (작업 소유권 명확해짐)</p>

    <p>문제점: 만약 <code class="language-plaintext highlighter-rouge">worker-1</code>이  작업을 <code class="language-plaintext highlighter-rouge">processing-queue</code>로 가져간 직후, 서버가 다운되어 영원히 복구되지 않으면 <code class="language-plaintext highlighter-rouge">task-123</code> 은 <code class="language-plaintext highlighter-rouge">worker-1-processing-queue</code>에 영원히 갇히게 된다. 다른 워커는 이 작업을 처리할 수 없다.</p>

    <p>보완책:</p>

    <ul>
      <li>일정 시간 이상 <code class="language-plaintext highlighter-rouge">processing-queue</code> 에 머물러 있는 작업을 감지하는 별도의 모니터링 스케줄러가 필요하다.</li>
      <li>이 스케줄러는 모든 <code class="language-plaintext highlighter-rouge">worker-*-processing-queue</code> 를 주기적으로 스캔한다.</li>
      <li>만약 특정 작업이 Timeout을 초과했다면, 해당 워커가 영구 장애 상태라고 간주하고 <code class="language-plaintext highlighter-rouge">LMOVE</code>를 사용해 해당 작업을 다시 <code class="language-plaintext highlighter-rouge">main-queue</code> 로 원자적으로 이동시킨다.</li>
      <li>타임아웃 초과 시 <code class="language-plaintext highlighter-rouge">LMOVE worker-1-processing-queue main-queue LEFT RIGHT</code>로 원자적으로 복구한다.</li>
      <li>이를 통해 다른 건강한 워커가 해당 작업을 이어받아 처리할 수 있다.</li>
    </ul>
  </li>
</ol>

<hr>

<h2 id="api-호출-실패-해결-방안">API 호출 실패 해결 방안</h2>

<p>API 호출 실패를 일시적 실패와 영구적 실패로 분리하여, 시스템 전체가 멈추는 것을 막는다.</p>

<h3 id="1-즉시-재시도-하지-않는-이유">1. 즉시 재시도 하지 않는 이유</h3>

<ul>
  <li>API 호출이 실패했을 때, 그 자리에서 while 루프문을 돌며 즉시 재시도를 하는 것이다.</li>
  <li>문제점: 워커 스레드는 계속 실패한 작업에만 묶여있게 되므로 그동안 <code class="language-plaintext highlighter-rouge">main-queue</code>에 쌓인 나머지 작업은 처리하지 못한다.</li>
</ul>

<h3 id="2-retry-queue의-역할-일시적-실패-처리">2. retry-queue의 역할 (일시적 실패 처리)</h3>

<p>retry-queue는 지금 당장 말고 나중에 다시 시도할 작업들을 모아둔다.</p>

<ul>
  <li>API 호출이 일시적 실패로 끝났을 때 사용
    <ul>
      <li>
<code class="language-plaintext highlighter-rouge">503 Service Unavailable</code> (서버 과부하), <code class="language-plaintext highlighter-rouge">Network Timeout</code> (네트워크 불안정)</li>
    </ul>
  </li>
  <li>동작:
    <ol>
      <li>워커가 <code class="language-plaintext highlighter-rouge">processing-queue</code>의 작업으로 API 호출했으나 에러를 받는다.</li>
      <li>워커가 이 작업을 즉시 재시도 하지 않는다.</li>
      <li>대신, <code class="language-plaintext highlighter-rouge">processing-queue</code> 에서 이 작업을 꺼내어 <code class="language-plaintext highlighter-rouge">retry-queue</code>에 넣는다.</li>
      <li>워커는 이 실패한 작업을 잊고, 즉시 <code class="language-plaintext highlighter-rouge">main-queue</code>로 돌아가 다음 작업을 처리한다.</li>
    </ol>
  </li>
  <li>
<code class="language-plaintext highlighter-rouge">retry-queue</code>의 처리:
    <ul>
      <li>이 큐는 별도의 워커(혹은 <code class="language-plaintext highlighter-rouge">main-queue</code>가 비었을 때만 이 큐를 보는 워커)가 처리한다.</li>
      <li>
<code class="language-plaintext highlighter-rouge">retry-queue</code>에서 작업을 꺼낼 때는 지연을 주어서 꺼낸다.(ex: 5분 뒤에 다시 시도)</li>
    </ul>
  </li>
</ul>

<h3 id="3-dlq-queue의-역할-영구적-실패-격리">3. dlq-queue의 역할 (영구적 실패 격리)</h3>

<p><code class="language-plaintext highlighter-rouge">dlq-queue</code> (Dead Letter Queue)는 재시도를 해도 절대 성공할 수 없는 작업들을 모아두는 큐이다.</p>

<ul>
  <li>API 호출이 영구적 실패로 끝났을 때 사용
    <ul>
      <li>
<code class="language-plaintext highlighter-rouge">400 Bad Request</code> (요청 형식이 잘못됨), <code class="language-plaintext highlighter-rouge">401 Unauthorized</code> (API 키가 틀림), <code class="language-plaintext highlighter-rouge">404 Not Found</code> (카카오 UUID가 존재하지 않음)</li>
    </ul>
  </li>
  <li>이건 계속 재시도 해도 똑같이 실패할 것인 작업을 넣는다.</li>
  <li>동작:
    <ol>
      <li>워커가 <code class="language-plaintext highlighter-rouge">processing-queue</code>의 작업으로 API 호출했으나 <code class="language-plaintext highlighter-rouge">400</code> 에러를 받는다.</li>
      <li>워커는 이 작업이 영구적 실패임을 인지한다.</li>
      <li>
<code class="language-plaintext highlighter-rouge">processing-queue</code>에서 이 작업을 꺼내서 <code class="language-plaintext highlighter-rouge">dlq-queue</code>에 넣는다.(원자적)</li>
      <li>이 큐로 이동된 작업은 처리 “실패로 처리 완료된 작업”으로 간주한다. (워커는 <code class="language-plaintext highlighter-rouge">main-queue</code>로 복귀)</li>
    </ol>
  </li>
  <li>
<code class="language-plaintext highlighter-rouge">dlq-queue</code>의 처리:
    <ul>
      <li>이 큐는 자동으로 처리되지 않는다.</li>
      <li>개발자가 수동으로 이 큐에 쌓인 작업들을 확인하여, 왜 특정 에러가 났는지 원인을 분석하고 버그를 수정한다.</li>
    </ul>
  </li>
</ul>

<h3 id="4-최대-재시도-횟수-관리">4. 최대 재시도 횟수 관리</h3>

<p><code class="language-plaintext highlighter-rouge">retry-queue</code>에 있는 작업이 5분 뒤에 재시도했는데 또 503 에러를 받을 수도 있다.</p>

<p>→ 무한 재시도를 막아야 한다.</p>

<p>최대 재시도 횟수 로직을 통해 <code class="language-plaintext highlighter-rouge">retry-queue</code>와 <code class="language-plaintext highlighter-rouge">dlq-queue</code> 를 연결한다.</p>

<ul>
  <li>최초 작업 페이로드에 <code class="language-plaintext highlighter-rouge">retryCount: 0</code>을 포함시킨다.</li>
  <li>N번 재시도 실패하면 영구적 실패로 간주하고 DLQ로 이동시킨다.</li>
</ul>

<h3 id="전체-흐름">전체 흐름</h3>

<ul>
  <li>워커가 <code class="language-plaintext highlighter-rouge">main-queue</code> -&gt; <code class="language-plaintext highlighter-rouge">processing-queue</code>로 작업을 가져온다.</li>
  <li>API를 호출한다.
    <ul>
      <li>
<strong>(성공):</strong> <code class="language-plaintext highlighter-rouge">processing-queue</code>에서 작업 삭제. <strong>(완료)</strong>
</li>
      <li>
<strong>(영구적 실패 / 4xx):</strong> <code class="language-plaintext highlighter-rouge">processing-queue</code> -&gt; <code class="language-plaintext highlighter-rouge">dlq-queue</code>로 이동. <strong>(완료-실패)</strong>
</li>
      <li>
<strong>(일시적 실패 / 5xx):</strong> <code class="language-plaintext highlighter-rouge">retryCount</code>를 확인.
        <ul>
          <li>
<code class="language-plaintext highlighter-rouge">count &lt; 3</code> : <code class="language-plaintext highlighter-rouge">retryCount</code>를 1 증가시키고 <code class="language-plaintext highlighter-rouge">processing-queue</code> -&gt; <code class="language-plaintext highlighter-rouge">retry-queue</code>로 이동.</li>
          <li>
<code class="language-plaintext highlighter-rouge">count &gt;= 3</code> : “최종 실패”로 간주. <code class="language-plaintext highlighter-rouge">processing-queue</code> -&gt; <code class="language-plaintext highlighter-rouge">dlq-queue</code>로 이동.</li>
        </ul>
      </li>
    </ul>
  </li>
</ul>

<h3 id="주의사항-1">주의사항</h3>

<p><code class="language-plaintext highlighter-rouge">processing-queue</code>에서 이 작업을 꺼내어 <code class="language-plaintext highlighter-rouge">retry-queue</code>에 넣거나, <code class="language-plaintext highlighter-rouge">retry-queue → dlq-queue</code> 에 넣을때도 원자적이지 않으면 데이터가 유실 될 수 있다.</p>

<p>→ 해결책: <code class="language-plaintext highlighter-rouge">LMOVE</code> 사용</p>

<ul>
  <li>
<code class="language-plaintext highlighter-rouge">main-queue</code> → <code class="language-plaintext highlighter-rouge">processing-queue</code>로 가져올 때 <code class="language-plaintext highlighter-rouge">BLMOVE</code>를 사용한 것처럼, 다른 큐로 보낼 때도 원자적 이동 명령어를 사용해야 한다.</li>
</ul>

<p><code class="language-plaintext highlighter-rouge">LMOVE</code> (Non-Blocking) vs <code class="language-plaintext highlighter-rouge">BLMOVE</code> (Blocking)</p>

<ol>
  <li>
<code class="language-plaintext highlighter-rouge">LMOVE</code>
    <ul>
      <li>소스 큐에서 아이템을 POP하여 목적지 큐로 PUSH한다.</li>
      <li>만약 소스 큐가 비어있으면: 즉시 <code class="language-plaintext highlighter-rouge">nil</code>(없음)을 반환하고 명령이 종료</li>
    </ul>
  </li>
  <li>
<code class="language-plaintext highlighter-rouge">BLMOVE</code>
    <ul>
      <li>소스 큐에서 아이템을 POP하여 목적지 큐로 PUSH한다.</li>
      <li>만약 소스 큐가 비어있으면: 명령이 즉시 종료되지 않고, 데이터가 들어올 때까지 지정된 시간동안 대기한다.</li>
    </ul>
  </li>
</ol>

<hr>

<h2 id="작업-완료-처리-실패-해결-방안">작업 완료 처리 실패 해결 방안</h2>

<p>최소 1회 전송을 보장하는 과정에서 중복 발송을 유발하는 실패 시나리오</p>

<p>→ 큐를 더 추가해서 해결하는 것이 아니라, 워커의 로직을 <strong>멱등성</strong> 있게 설계하여 해결한다.</p>

<ul>
  <li>멱등성: 같은 작업을 여러 번 수행해도, 그 결과는 1번 수행한 것과 같아야 한다.</li>
</ul>

<p>즉, 워커가 재시작되어 중복 발송을 시도하더라도, 실제 발송이 2번 일어나지 않게 방어하는 것</p>

<hr>

<h3 id="멱등성-검사를-통한-해결">멱등성 검사를 통한 해결</h3>

<p>워커는 작업을 처리할 때, <strong>무조건 API부터 호출하는 것이 아니라 DB의 ‘최종 상태’를 먼저 확인</strong>해야 한다.</p>

<ol>
  <li>
<strong>[워커 재시작]</strong><br>
워커 A가 재시작된다.</li>
  <li>
<strong>[백업 큐 확인]</strong><br>
로직 1순위로 <code class="language-plaintext highlighter-rouge">worker-A-processing-queue</code>를 확인(<code class="language-plaintext highlighter-rouge">LRANGE 0 0</code>)하고, API 호출/DB 기록/큐 삭제가 모두 실패했던 <code class="language-plaintext highlighter-rouge">task-123</code>을 발견한다.</li>
  <li>
<strong>[멱등성 검사 (Idempotency Check)]</strong><br>
워커 A는 <code class="language-plaintext highlighter-rouge">task-123</code>을 보고 <strong>API를 바로 호출하지 않는다.</strong><br>
대신, <code class="language-plaintext highlighter-rouge">task-123</code>에 포함된 <code class="language-plaintext highlighter-rouge">logId</code> (예: 9876)를 가지고 <strong><code class="language-plaintext highlighter-rouge">quiz_notification_log</code> DB를 먼저 조회한다.</strong><br>
<code class="language-plaintext highlighter-rouge">SELECT status FROM quiz_notification_log WHERE id = 9876;</code>
</li>
  <li>
<strong>[상태 확인 및 결정] 워커 A가 DB에서 조회한 <code class="language-plaintext highlighter-rouge">status</code>를 확인한다.</strong>
    <ul>
      <li>CASE 1: <code class="language-plaintext highlighter-rouge">status = 'SENT'</code> (6단계 실패: 큐 삭제만 실패한 경우)</li>
    </ul>
  </li>
</ol>

<p><strong>[방어 로직 실행]</strong></p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>- 워커 A는 API 발송도 성공했고 DB 기록도 성공했음을 알고 Redis 큐에서 삭제만 실패했던 것임을 인지한다.
- **카카오 API 호출을 절대로 하지 않는다. (SKIP)**
- 대신, **실패했던 마지막 단계(큐 삭제)만** 다시 수행한다.
- `LREM worker-A-processing-queue 1 task-123` 명령을 실행하여 백업 큐를 정리한다. - CASE 2: `status = 'PROCESSING'` (5단계 실패: SENT 기록만 실패한 경우)
</code></pre></div></div>

<p><code class="language-plaintext highlighter-rouge">PROCESSING</code> 상태는 ‘보냈을 수도 있고 안 보냈을 수도 있는’ 애매한 상태라,</p>

<p><strong>최소 1회 보장 원칙 때문에 중복 가능성을 감수하고 재호출한다</strong></p>

<p>[방어 로직 실행]</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>- 워커 A는 “API 호출은 성공했을 수 있으나, DB SENT 기록은 실패했음”을 인지한다.
- ‘최소 1회 보장’ 원칙에 따라, 이 작업은 완료된 것이 아니므로 재시도한다.
- (중복 발송을 감수하고) API 호출부터 다시 시도한다.
- (API 호출 → DB SENT 변경 → LREM) - CASE 3: `status == 'QUEUED'` (매우 드문 경우: PROCESSING 변경조차 실패한 경우)
</code></pre></div></div>

<p>[방어 로직 실행]</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>- 워커 A는 “이 작업은 API 호출 시도조차 못했음”을 인지한다.
- 당연히 API 호출부터 다시 시도한다.
- (DB (`QUEUED` → `PROCESSING` )변경 → API 호출 → DB SENT 변경 → LREM)
</code></pre></div></div>

<h3 id="주의사항-2">주의사항</h3>

<p>처음 큐에서 받은 작업이든, 재시작 후 발견한 작업이든, 워커는 항상 API 호출하기 직전에 DB의 status를 확인하는 것이 안전한 멱등성 설계이다.</p>

<p>→ 워커의 처리 로직을 단순하고 통일성 있게 유지할 수 있다.</p>

<p>→ 워커가 작업을 확보한 후 실행하는 로직은 항상 동일해야 한다. (분기 처리를 피함)</p>

<h3 id="결론">결론</h3>

<p>워커가 작업 시작 전 DB 상태를 먼저 <strong>확인(SELECT)하는 멱등성 검사 로직</strong>을 가지고 있으면,<br>
<strong>6단계 실패(API 호출과 DB 기록까지 성공)한 작업</strong>이 재시도되더라도, 워커가 <code class="language-plaintext highlighter-rouge">SENT</code> 상태를 감지하고 API 호출을 건너뛰어 중복 발송을 방지한다.<br>
<strong>5단계 실패(API 호출 후 <code class="language-plaintext highlighter-rouge">PROCESSING</code> 상태에 멈춤)한 작업</strong>은, ‘최소 1회 보장’ 원칙에 따라 중복을 감수하고 재시도하여 <strong>메시지 누락을 방지한다.</strong></p>

<hr>

    <!-- see https://giscus.app/ -->
    <div class="giscus" id="giscus" style="margin: 4rem auto;"></div>
    <div id="related-box">
        <span>
            <svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 512 512"><path d="M278.5 215.6L23 471c-9.4 9.4-9.4 24.6 0 33.9s24.6 9.4 33.9 0l74.8-74.8c7.4 4.6 15.3 8.2 23.8 10.5C200.3 452.8 270 454.5 338 409.4c12.2-8.1 5.8-25.4-8.8-25.4l-16.1 0c-5.1 0-9.2-4.1-9.2-9.2c0-4.1 2.7-7.6 6.5-8.8l97.7-29.3c3.4-1 6.4-3.1 8.4-6.1c4.4-6.4 8.6-12.9 12.6-19.6c6.2-10.3-1.5-23-13.5-23l-38.6 0c-5.1 0-9.2-4.1-9.2-9.2c0-4.1 2.7-7.6 6.5-8.8l80.9-24.3c4.6-1.4 8.4-4.8 10.2-9.3C494.5 163 507.8 86.1 511.9 36.8c.8-9.9-3-19.6-10-26.6s-16.7-10.8-26.6-10C391.5 7 228.5 40.5 137.4 131.6C57.3 211.7 56.7 302.3 71.3 356.4c2.1 7.9 12 9.6 17.8 3.8L253.6 195.8c6.2-6.2 16.4-6.2 22.6 0c5.4 5.4 6.1 13.6 2.2 19.8z"></path></svg>
            You May Also Like
        </span>
        <ul id="related-posts"></ul>
    </div>
</main>
<div class="top-arrow">
    <svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 384 512"><path d="M214.6 41.4c-12.5-12.5-32.8-12.5-45.3 0l-160 160c-12.5 12.5-12.5 32.8 0 45.3s32.8 12.5 45.3 0L160 141.2V448c0 17.7 14.3 32 32 32s32-14.3 32-32V141.2L329.4 246.6c12.5 12.5 32.8 12.5 45.3 0s12.5-32.8 0-45.3l-160-160z"></path></svg>
</div>
                
            </div>
        </div>
        <div id="search">
    <div class="wave"></div>
    <div class="wave"></div>
    <div class="wave"></div>

    <div class="search-box">
        <mark>Touch background to close</mark>
        <div class="input-box">
            <input id="search-input" type="search" tabindex="1" spellcheck="false" placeholder="Search...">
            <button id="btn-clear">
                <svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 384 512"><path d="M342.6 150.6c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0L192 210.7 86.6 105.4c-12.5-12.5-32.8-12.5-45.3 0s-12.5 32.8 0 45.3L146.7 256 41.4 361.4c-12.5 12.5-12.5 32.8 0 45.3s32.8 12.5 45.3 0L192 301.3 297.4 406.6c12.5 12.5 32.8 12.5 45.3 0s12.5-32.8 0-45.3L237.3 256 342.6 150.6z"></path></svg>
            </button>
        </div>
        <ul id="search-result"></ul>
    </div>
</div>
    </body>
    <script defer src="/assets/js/background.js"></script>
<script defer src="https://www.googletagmanager.com/gtag/js?id="></script>
<script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){ dataLayer.push(arguments); }

    gtag('js', new Date());
    gtag('config', '');
</script>
    
        <script src="/assets/js/post.js"></script>
        <link rel="preload" href="/assets/css/highlight.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
        <noscript><link rel="stylesheet" href="/assets/css/highlight.min.css"></noscript>
        <script defer src="/assets/js/highlight.min.js"></script>
    
    <script src="/assets/js/common.js"></script>

    <script defer>
    var posts = [];

    

        posts.push({
            'title'    : "Index",
            'path'     : "Architecture > api-design",
            'type'     : "category",
            'tags'     : "",
            'url'      : "/Architecture/api-design/index.html",
            'image'    : "/assets/img/thumbnail/empty.jpg",
            'date'     : "1900-01-01"
        });
    

        posts.push({
            'title'    : "Index",
            'path'     : "Architecture > data-modeling-erd",
            'type'     : "category",
            'tags'     : "",
            'url'      : "/Architecture/data-modeling-erd/index.html",
            'image'    : "/assets/img/thumbnail/empty.jpg",
            'date'     : "1900-01-01"
        });
    

        posts.push({
            'title'    : "Index",
            'path'     : "Architecture",
            'type'     : "category",
            'tags'     : "",
            'url'      : "/Architecture/index.html",
            'image'    : "/assets/img/thumbnail/empty.jpg",
            'date'     : "1900-01-01"
        });
    

        posts.push({
            'title'    : "Index",
            'path'     : "Architecture > security-auth",
            'type'     : "category",
            'tags'     : "",
            'url'      : "/Architecture/security-auth/index.html",
            'image'    : "/assets/img/thumbnail/empty.jpg",
            'date'     : "1900-01-01"
        });
    

        posts.push({
            'title'    : "Index",
            'path'     : "Architecture > system-design",
            'type'     : "category",
            'tags'     : "",
            'url'      : "/Architecture/system-design/index.html",
            'image'    : "/assets/img/thumbnail/empty.jpg",
            'date'     : "1900-01-01"
        });
    

        posts.push({
            'title'    : "Index",
            'path'     : "Java",
            'type'     : "category",
            'tags'     : "",
            'url'      : "/Java/index.html",
            'image'    : "/assets/img/thumbnail/empty.jpg",
            'date'     : "1900-01-01"
        });
    

        posts.push({
            'title'    : "Index",
            'path'     : "Spring Boot > Security",
            'type'     : "category",
            'tags'     : "",
            'url'      : "/Spring%20Boot/Security/index.html",
            'image'    : "/assets/img/thumbnail/empty.jpg",
            'date'     : "1900-01-01"
        });
    

        posts.push({
            'title'    : "Index",
            'path'     : "Spring Boot",
            'type'     : "category",
            'tags'     : "",
            'url'      : "/Spring%20Boot/index.html",
            'image'    : "/assets/img/thumbnail/empty.jpg",
            'date'     : "1900-01-01"
        });
    

        posts.push({
            'title'    : "Index",
            'path'     : "Trouble Shooting",
            'type'     : "category",
            'tags'     : "",
            'url'      : "/Trouble%20Shooting/index.html",
            'image'    : "/assets/img/thumbnail/empty.jpg",
            'date'     : "1900-01-01"
        });
    

        posts.push({
            'title'    : "Index",
            'path'     : "",
            'type'     : "category",
            'tags'     : "",
            'url'      : "/index.html",
            'image'    : "/assets/img/thumbnail/empty.jpg",
            'date'     : "1900-01-01"
        });
    

        posts.push({
            'title'    : "[Java Concurrency] Thread.start()와 Thread 객체의 모니터 락 획득 과정",
            'path'     : "Java",
            'type'     : "post",
            'tags'     : "java, Concurrency, monitor lock, thread, synchronized, multi thread",
            'url'      : "/Java/thread-monitor-lock-1.html",
            'image'    : "/assets/img/thumbnail/thread-monitor-lock-1.png",
            'date'     : "2025-09-26"
        });
    

        posts.push({
            'title'    : "[Java Concurrency] 모니터 락과 wait/notifyAll로 턴 스케줄러 구현하기",
            'path'     : "Java",
            'type'     : "post",
            'tags'     : "java, Concurrency, monitor lock, wait-notifyAll",
            'url'      : "/Java/monitor-lock-1.html",
            'image'    : "/assets/img/thumbnail/monitor-lock-1.png",
            'date'     : "2025-09-30"
        });
    

        posts.push({
            'title'    : "[Java Multithreading] Part 1 – Thread.start() vs run() : 자바 코드 + 간단한 흐름 비교",
            'path'     : "Java",
            'type'     : "post",
            'tags'     : "java, concurrency, thread, start, run, jvm",
            'url'      : "/Java/java-thread-start-part1-start-vs-run-code-and-flow.html",
            'image'    : "/assets/img/thumbnail/thread-start.png",
            'date'     : "2025-10-02"
        });
    

        posts.push({
            'title'    : "[Java Multithreading] Part 2 – Thread.start() 뒤에서 일어나는 일: registerNatives ~ JVM_StartThread ~ JavaThread",
            'path'     : "Java",
            'type'     : "post",
            'tags'     : "java, concurrency, thread, start, run, jvm",
            'url'      : "/Java/java-thread-start-part2-start0-jvm-startthread-javathread.html",
            'image'    : "/assets/img/thumbnail/thread-start.png",
            'date'     : "2025-10-03"
        });
    

        posts.push({
            'title'    : "[Java Multithreading] Part 3 – JVM이 OS 스레드를 만드는 과정: JavaThread, os::create_thread, pthread_create, glibc, clone()",
            'path'     : "Java",
            'type'     : "post",
            'tags'     : "java, concurrency, thread, start, run, jvm",
            'url'      : "/Java/java-thread-start-part3-os-create-thread-pthread-glibc-clone.html",
            'image'    : "/assets/img/thumbnail/thread-start.png",
            'date'     : "2025-10-04"
        });
    

        posts.push({
            'title'    : "[Java Multithreading] Part 4 – 새로운 스레드가 자바 run()에 도달하기까지: thread_native_entry → JavaThread::run → thread_entry → Thread.run()",
            'path'     : "Java",
            'type'     : "post",
            'tags'     : "java, concurrency, thread, start, run, jvm",
            'url'      : "/Java/java-thread-start-part4-thread-entry-to-run.html",
            'image'    : "/assets/img/thumbnail/thread-start.png",
            'date'     : "2025-10-04"
        });
    

        posts.push({
            'title'    : "[Java Multithreading] 마지막 글 - 스레드 관점에서 한눈에 정리: new → start → run → 종료 후 상태",
            'path'     : "Java",
            'type'     : "post",
            'tags'     : "java, concurrency, thread, start, run, jvm",
            'url'      : "/Java/java-thread-start-part5-thread-lifecycle-summary.html",
            'image'    : "/assets/img/thumbnail/thread-start.png",
            'date'     : "2025-10-06"
        });
    

        posts.push({
            'title'    : "[Firebase/Java] Firestore ApiFuture와 Java Future, 그리고 Reactor Mono까지 – 비동기 흐름 뜯어보기",
            'path'     : "Java",
            'type'     : "post",
            'tags'     : "java, firestore, apifuture, future, listenablefuture, reactor, mono, async, concurrency",
            'url'      : "/Java/firestore-apifuture-future-mono-async-flow.html",
            'image'    : "/assets/img/thumbnail/firestore-apifuture-future-mono-async-flow.png",
            'date'     : "2025-10-25"
        });
    

        posts.push({
            'title'    : "[시스템 설계] 하루 한 번 알림을 “누락 없이” 보내기 위한 Redis 큐 &amp; 워커 설계",
            'path'     : "Architecture > system-design",
            'type'     : "post",
            'tags'     : "redis, worker, at-least-once-notification, spring schedule, blmove, redis-queue-blmove-idempotency",
            'url'      : "/Architecture/system-design/at-least-once-notification-redis-queue-blmove-idempotency.html",
            'image'    : "/assets/img/thumbnail/at-least-once-notification-redis-queue-blmove-idempotency.png",
            'date'     : "2025-11-03"
        });
    

        posts.push({
            'title'    : "카카오 OAuth 로그인 흐름 이해하기: JS SDK + Authorization Code 플로우",
            'path'     : "Architecture > security-auth",
            'type'     : "post",
            'tags'     : "springboot, spring-security, oauth2, kakao, login, diagram",
            'url'      : "/Architecture/security-auth/2025-11-30-kakao-login.html",
            'image'    : "/assets/img/thumbnail/2025-11-30-kakao-login.png",
            'date'     : "2025-11-30"
        });
    

        posts.push({
            'title'    : "[Docker Troubleshooting] Spring Redis UnknownHostException 해결기: Spring 앱과 Redis의 외부 네트워크와 DNS 스코프 문제",
            'path'     : "Trouble Shooting",
            'type'     : "post",
            'tags'     : "docker, docker-compose, redis, spring, networking, dns, ec2, devops, troubleshooting",
            'url'      : "/Trouble%20Shooting/docker-redis-network-dns.html",
            'image'    : "/assets/img/thumbnail/docker-redis-network-dns.png",
            'date'     : "2025-12-08"
        });
    

    searchPost(posts);

    
        searchRelated(posts);
    
</script>
    <script type="module">
        import mermaid from "https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.esm.min.mjs";
        document.addEventListener("DOMContentLoaded", function () {
            mermaid.initialize({ startOnLoad: true });
        });
    </script>
</html>
